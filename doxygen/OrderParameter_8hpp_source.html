<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>ESPResSo++: /home/travis/build/espressopp/espressopp/src/analysis/OrderParameter.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ESPResSo++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a></li><li class="navelem"><a class="el" href="dir_bacb04149764cbf6394e26ac332ca39a.html">travis</a></li><li class="navelem"><a class="el" href="dir_658dffd2684749c363737148727fc8b1.html">build</a></li><li class="navelem"><a class="el" href="dir_5c08f133502774d40ee791d106d3c75a.html">espressopp</a></li><li class="navelem"><a class="el" href="dir_805259ce9380bb65a7430128d5e0f497.html">espressopp</a></li><li class="navelem"><a class="el" href="dir_840424569f8391225c4dad9612f75a9e.html">src</a></li><li class="navelem"><a class="el" href="dir_b33d47cb326370002da52f5daea73f20.html">analysis</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">OrderParameter.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="OrderParameter_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">  Copyright (C) 2012,2013</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">      Max Planck Institute for Polymer Research</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">  Copyright (C) 2008,2009,2010,2011</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">      Max-Planck-Institute for Polymer Research &amp; Fraunhofer SCAI</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">  This file is part of ESPResSo++.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">  ESPResSo++ is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">  it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">  the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">  (at your option) any later version.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">  ESPResSo++ is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">  GNU General Public License for more details.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">  </span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">  You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. </span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">// ESPP_CLASS</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#ifndef _ANALYSIS_ORDERPARAMETER_HPP</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define _ANALYSIS_ORDERPARAMETER_HPP</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mpi_8hpp.html">mpi.hpp</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="types_8hpp.html">types.hpp</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AnalysisBase_8hpp.html">AnalysisBase.hpp</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="RealND_8hpp.html">RealND.hpp</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Storage_8hpp.html">storage/Storage.hpp</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Error_8hpp.html">esutil/Error.hpp</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CellListIterator_8hpp.html">iterator/CellListIterator.hpp</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CellListAllPairsIterator_8hpp.html">iterator/CellListAllPairsIterator.hpp</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Cell_8hpp.html">Cell.hpp</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;boost/unordered_map.hpp&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;boost/unordered_set.hpp&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;boost/serialization/vector.hpp&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;boost/serialization/complex.hpp&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// #include &lt;boost/math/special_functions/spherical_harmonic.hpp&gt;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">using namespace </span>boost;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">   51</a></span>&#160;<span class="keyword">typedef</span> complex&lt;espressopp::real&gt; <a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">dcomplex</a>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// the following constant is not defined everywhere (e.g. not in Mac OS X)</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#ifndef M_PIl</span></div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="code" href="OrderParameter_8hpp.html#a126570edaffa4fa37291be26b3b8fdce">   55</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define M_PIl 3.1415926535897932384626433832795029L</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">// TODO create the total map: cpu &lt;-&gt; pid</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keyword">namespace </span>espressopp {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keyword">namespace </span>analysis {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keyword">using namespace </span>iterator;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// auxiliary class for storing additional properties of each bead for order analysis</span></div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">   67</a></span>&#160;    <span class="keyword">class </span><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>{</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keyword">private</span>:</div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a4f93a7043adb1d05d374b14472246b32">   69</a></span>&#160;      <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a4f93a7043adb1d05d374b14472246b32">d</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a34217f63fe98bb35f33431e07bb3a6f8">   70</a></span>&#160;      <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a34217f63fe98bb35f33431e07bb3a6f8">qlmSumSqrt</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a0163e247ad6bd9c4eafb3fb7ebe383f0">   71</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a0163e247ad6bd9c4eafb3fb7ebe383f0">nnns</a>;     <span class="comment">// number of near neighbors</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      </div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a8562d037b4049af3db66157d690c3f30">   73</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a8562d037b4049af3db66157d690c3f30">ang_m</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a9bffa988deae9246e23d95e5ac946684">   74</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a9bffa988deae9246e23d95e5ac946684">particle_id</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      </div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a549440de56e6d60dd14f1c3b94fd06a8">   76</a></span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a549440de56e6d60dd14f1c3b94fd06a8">is_solid</a>;   <span class="comment">// if true the particle belongs to solid phase</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a839a21a6f15f87ae200cebd7065b360f">   77</a></span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a839a21a6f15f87ae200cebd7065b360f">is_surface</a>; <span class="comment">// if true the particle belongs to the surface</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        </div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a7b6f4ecc8a70b6d99bfdbb1989966474">   79</a></span>&#160;      vector&lt;int&gt; <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a7b6f4ecc8a70b6d99bfdbb1989966474">nns</a>;</div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#afdd18352152208555ebc4de43b55d230">   80</a></span>&#160;      vector&lt;dcomplex&gt; <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#afdd18352152208555ebc4de43b55d230">qlm</a>; <span class="comment">//  depends on angular_momentum =2*angular_momentum+1</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      </div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a05eab40c2ece82b8c33c24777801e866">   82</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a05eab40c2ece82b8c33c24777801e866">label</a>; <span class="comment">// variable for cluster analysis</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      </div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ac98d07dd8f7b70e16ccb9a01abf56b9c">   84</a></span>&#160;      <span class="keyword">friend</span> <span class="keyword">class </span>boost::serialization::access;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="keyword">template</span>&lt;<span class="keyword">class</span> Archive&gt;</div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a8a03118226c32c7180ac2878139089c8">   86</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a8a03118226c32c7180ac2878139089c8">serialize</a>(Archive &amp; ar, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> version) {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        ar &amp; d;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        ar &amp; qlmSumSqrt;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        ar &amp; nnns;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        ar &amp; ang_m;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        ar &amp; particle_id;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        ar &amp; nns;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        ar &amp; qlm;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        ar &amp; is_solid;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        ar &amp; is_surface;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        ar &amp; label;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keyword">public</span>:</div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a68abc12957435bd96b9a7671302b3c11">  100</a></span>&#160;      <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>() : d(0),</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                             qlmSumSqrt(0),</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                             nnns(0),</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                             ang_m(0),</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                             particle_id(-1),</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                             label(-1){</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        is_solid = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        is_surface = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      </div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa374e7f80ca235210439d4eb1f7d740c">  110</a></span>&#160;      <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>(<span class="keywordtype">int</span> am) : d(0),</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                                   qlmSumSqrt(0),</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                                   nnns(0),</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                   ang_m(am),</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                   particle_id(-1),</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                   label(-1){</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        qlm = vector&lt;dcomplex&gt;(2*am+1, <a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">dcomplex</a>(0.0, 0.0) );</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        is_solid = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        is_surface = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      }</div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad76371cae90eb1c1dceebd787bed77d2">  120</a></span>&#160;      <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>(<span class="keywordtype">int</span> am, <span class="keywordtype">int</span> pid) : d(0),</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                                            qlmSumSqrt(0),</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                                            nnns(0),</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                            ang_m(am),</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                            particle_id(pid),</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                            label(-1){</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        qlm = vector&lt;dcomplex&gt;(2*am+1, <a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">dcomplex</a>(0.0, 0.0) );</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        is_solid = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        is_surface = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      }</div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5ee9d0ae1288665389f20ce3783d8763">  130</a></span>&#160;      <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5ee9d0ae1288665389f20ce3783d8763">~OrderParticleProps</a>(){}</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      </div>
<div class="line"><a name="l00132"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af3f4f0deb34dfc670de92425c78564e4">  132</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af3f4f0deb34dfc670de92425c78564e4">insertNN</a>(<span class="keywordtype">int</span> i){</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        nnns++; <span class="comment">// increase the number of near neighbors</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        nns.push_back( i );</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      }</div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#afee8adb7385085c898d4746f24498944">  136</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#afee8adb7385085c898d4746f24498944">getNN</a>(<span class="keywordtype">int</span> i){ <span class="keywordflow">return</span> nns[i]; }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      </div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#acc997cda69a26cda2e9a9c69a83b2787">  138</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#acc997cda69a26cda2e9a9c69a83b2787">getNumNN</a>(){ <span class="keywordflow">return</span> nnns; }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="comment">// index defined as -l, -l+1, ..., 0, ..., l-1, l for convenience </span></div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa5f03d5a021f790058ac62ef3e098f50">  141</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa5f03d5a021f790058ac62ef3e098f50">setQlm</a>(<span class="keywordtype">int</span> indx, <a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">dcomplex</a> v){</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordtype">int</span> hh = indx + ang_m;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">if</span>(hh&lt;0 || hh&gt;=2*ang_m+1) cout&lt;&lt;<span class="stringliteral">&quot;OUT OF RANGE!!&quot;</span>&lt;&lt;endl;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        qlm[ indx + ang_m ] = v;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      }</div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a156bdc65d2b00091c8892f21d93c62ad">  146</a></span>&#160;      <a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">dcomplex</a> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a156bdc65d2b00091c8892f21d93c62ad">getQlm</a>(<span class="keywordtype">int</span> indx){</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordtype">int</span> hh = indx + ang_m;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">if</span>(hh&lt;0 || hh&gt;=2*ang_m+1) cout&lt;&lt;<span class="stringliteral">&quot;OUT OF RANGE!!&quot;</span>&lt;&lt;endl;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">return</span> qlm[ indx + ang_m ];</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      }</div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01e07544bf75b9315c62b91cdaeaec3d">  151</a></span>&#160;      vector&lt;dcomplex&gt; <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01e07544bf75b9315c62b91cdaeaec3d">getQlmVector</a>(){ <span class="keywordflow">return</span> qlm; }</div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a119d9f5c9c5db2033c1d9811da7693b9">  152</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a119d9f5c9c5db2033c1d9811da7693b9">addQlmVector</a>(vector&lt;dcomplex&gt; v){</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">if</span>( v.size() != qlm.size() )</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;          cout&lt;&lt;<span class="stringliteral">&quot;Vectors have not the same size. Local: &quot;</span>&lt;&lt; qlm.size() &lt;&lt; <span class="stringliteral">&quot;  added  &quot;</span>&lt;&lt; v.size() &lt;&lt;endl;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;qlm.size(); i++){</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;          qlm[ i ] += v[ i ];</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      }</div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a3ef2ff0c66180487ce4ec06d3b069d0d">  159</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a3ef2ff0c66180487ce4ec06d3b069d0d">setQlm</a>(vector&lt;dcomplex&gt; v){</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">if</span>( v.size() != qlm.size() )</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;          cout&lt;&lt;<span class="stringliteral">&quot;Vectors have not the same size. Local: &quot;</span>&lt;&lt; qlm.size() &lt;&lt; <span class="stringliteral">&quot;  new  &quot;</span>&lt;&lt; v.size() &lt;&lt;endl;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;qlm.size(); i++){</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;          qlm[ i ] = v[ i ];</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a02e3def57d0578730ac38539ccc4953d">  167</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a02e3def57d0578730ac38539ccc4953d">calculateSumQlm</a>(){</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        qlmSumSqrt = 0;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">for</span>(vector&lt;dcomplex&gt;::iterator it = qlm.begin(); it!=qlm.end(); ++it){</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;          qlmSumSqrt += norm( *it );</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        qlmSumSqrt = sqrt(qlmSumSqrt);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      }</div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a76253a92836e0046fdcff319af854cb0">  174</a></span>&#160;      <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a76253a92836e0046fdcff319af854cb0">getSumQlm</a>(){ <span class="keywordflow">return</span> qlmSumSqrt; }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      </div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af5d5f4d85e487d62d4afe19ffe22dcb6">  176</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af5d5f4d85e487d62d4afe19ffe22dcb6">setD</a>(<a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> v){ d = v;}</div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">  177</a></span>&#160;      <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">getD</a>(){ <span class="keywordflow">return</span> d;}</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      </div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b495e94ec1ef4d29fa667361a30d5c8">  179</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b495e94ec1ef4d29fa667361a30d5c8">setPID</a>(<span class="keywordtype">int</span> v){ particle_id = v;}</div>
<div class="line"><a name="l00180"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">  180</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>(){ <span class="keywordflow">return</span> particle_id;}</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      </div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a4a3eb37b6aca1da43a0fc8a95f964285">  182</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a4a3eb37b6aca1da43a0fc8a95f964285">setSolid</a>(<span class="keywordtype">bool</span> v){ is_solid = v;}</div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad2c4a4d657f9e6b8a5fd18038e06749c">  183</a></span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad2c4a4d657f9e6b8a5fd18038e06749c">getSolid</a>(){ <span class="keywordflow">return</span> is_solid;}</div>
<div class="line"><a name="l00184"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#adad7f9bdce7744465f0aa018c439380c">  184</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#adad7f9bdce7744465f0aa018c439380c">setSurface</a>(<span class="keywordtype">bool</span> v){ is_surface = v;}</div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">  185</a></span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">getSurface</a>(){ <span class="keywordflow">return</span> is_surface;}</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      </div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a9624dec86b45ebdeb402ec2fb273b85e">  187</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a9624dec86b45ebdeb402ec2fb273b85e">setLabel</a>(<span class="keywordtype">int</span> v){ label = v;}</div>
<div class="line"><a name="l00188"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">  188</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>(){ <span class="keywordflow">return</span> label;}</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    };</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    </div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html">  194</a></span>&#160;    <span class="keyword">class </span><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html" title="compute order parameter.">OrderParameter</a> : <span class="keyword">public</span> <a class="code" href="classespressopp_1_1analysis_1_1AnalysisBaseTemplate.html">AnalysisBaseTemplate</a>&lt; RealND &gt; {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keyword">private</span>:</div>
<div class="line"><a name="l00196"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#adf6f36859ed1b8972d364dcb3d8440fe">  196</a></span>&#160;      <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#adf6f36859ed1b8972d364dcb3d8440fe">cutoff</a>;     <span class="comment">// cut off in order to define pairs</span></div>
<div class="line"><a name="l00197"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a7d06bab04c9a362e6ce969fab1c14bb6">  197</a></span>&#160;      <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a7d06bab04c9a362e6ce969fab1c14bb6">cutoff_sq</a>;  <span class="comment">// cutoff^2</span></div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a23a154f143d39491963a2ef9be4e274f">  198</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a23a154f143d39491963a2ef9be4e274f">angular_momentum</a>;   <span class="comment">// angular momentum</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="comment">//vector&lt;OrderParticleProps&gt; opp;   // additional properties</span></div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a4a78ece70bfd460e2f0e9b938863cbab">  201</a></span>&#160;      boost::unordered_multimap &lt;int, OrderParticleProps&gt; <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a4a78ece70bfd460e2f0e9b938863cbab">opp_map</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      </div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a2f3ea3d011e9ab0ac2c8f0b33b7bb643">  203</a></span>&#160;      boost::unordered_multimap &lt;int, int&gt; <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a2f3ea3d011e9ab0ac2c8f0b33b7bb643">pairs</a>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">       * Cluster analysis.</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">       */</span></div>
<div class="line"><a name="l00208"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a9c271284f36eedf484a56fe54df357ef">  208</a></span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a9c271284f36eedf484a56fe54df357ef">do_cl_an</a>;  <span class="comment">// if true, then cluster analysis will be performed after calculation of d</span></div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a1228111e1a9ae6c439c30e43d0023187">  209</a></span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a1228111e1a9ae6c439c30e43d0023187">incl_surface</a>;  <span class="comment">// if true, then the surface particle will be included as well</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">       * -1 &lt;= d &lt;= 1, thus d_min and d_max should maintain the same property.</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">       * </span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">       *  if d_min &lt; d_max, then the solid particle will be defined</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">       *  in range d_min &lt;= d &lt;= d_max</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">       * </span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">       *  if d_min &gt; d_max, then </span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">       *     -1.0 &lt;= d &lt;= d_min </span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">       *    d_max &lt;= d &lt;= 1.0</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">       */</span></div>
<div class="line"><a name="l00220"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#ae91434797eadd16a8d54e342d71b703e">  220</a></span>&#160;      <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#ae91434797eadd16a8d54e342d71b703e">d_min</a>, d_max;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      </div>
<div class="line"><a name="l00222"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a80a3c994f2be9c52e8a0cbb185645b09">  222</a></span>&#160;      <span class="keywordtype">int</span> max_cluster, <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a80a3c994f2be9c52e8a0cbb185645b09">number_of_clust</a>; <span class="comment">// a size of a biggest cluster and number of clusters</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">public</span>:</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="namespaceespressopp_1_1analysis.html#a28a2d26f3ec5c6a83732697b582fd664">registerPython</a>();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#ae3f2b59d687105916e26b9015349a821">  227</a></span>&#160;      <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html" title="compute order parameter.">OrderParameter</a>(shared_ptr&lt; System &gt; system, </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                     <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> _cutoff,</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                     <span class="keywordtype">int</span> _angular_momentum,</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                     <span class="keywordtype">bool</span> _do_cl_an,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                     <span class="keywordtype">bool</span> _incl_surface,</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                     <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> _d_min,</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                     <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> _d_max) :</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                        <a class="code" href="classespressopp_1_1analysis_1_1AnalysisBaseTemplate.html">AnalysisBaseTemplate</a>&lt; <a class="code" href="classespressopp_1_1RealND.html">RealND</a> &gt;(system),</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                        cutoff(_cutoff),</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                        angular_momentum(_angular_momentum),</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                        do_cl_an(_do_cl_an),</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                        incl_surface(_incl_surface),</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                        d_min(_d_min),</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                        d_max(_d_max){</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        cutoff_sq = cutoff * cutoff;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        max_cluster = 0;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        number_of_clust = 0;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      }</div>
<div class="line"><a name="l00245"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a9ea7543294f237097380d98c63b22bda">  245</a></span>&#160;      <span class="keyword">virtual</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a9ea7543294f237097380d98c63b22bda">~OrderParameter</a>() {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">dcomplex</a> SphHarm(<span class="keywordtype">int</span> l_, <span class="keywordtype">int</span> m_, <a class="code" href="classespressopp_1_1Real3D.html">Real3D</a> r_);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      </div>
<div class="line"><a name="l00250"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a781ac1c14f657cfbaecf284643b0dd73">  250</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a781ac1c14f657cfbaecf284643b0dd73">setAngularMomentum</a>(<span class="keywordtype">int</span> v){ angular_momentum = v; }</div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a2374f81a275eb280439a639443a94278">  251</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a2374f81a275eb280439a639443a94278">getAngularMomentum</a>(){ <span class="keywordflow">return</span> angular_momentum; }</div>
<div class="line"><a name="l00252"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a63f8c80d57a859d2a8d9bea17a2b7a70">  252</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a63f8c80d57a859d2a8d9bea17a2b7a70">setCutoff</a>(<a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> v){</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        cutoff = v;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        cutoff_sq = cutoff * cutoff;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      }</div>
<div class="line"><a name="l00256"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a0429f9b1598131124dfdf92d03d25ca8">  256</a></span>&#160;      <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a0429f9b1598131124dfdf92d03d25ca8">getCutoff</a>(){ <span class="keywordflow">return</span> cutoff; }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="comment">// **************************** cluster analysis</span></div>
<div class="line"><a name="l00259"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#accf4c5216ae8665abec7623db245696e">  259</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#accf4c5216ae8665abec7623db245696e">setDo_cl_an</a>(<span class="keywordtype">bool</span> v){ do_cl_an = v; }</div>
<div class="line"><a name="l00260"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a5d7075330da5fa133d09c279721b0cb9">  260</a></span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a5d7075330da5fa133d09c279721b0cb9">getDo_cl_an</a>(){ <span class="keywordflow">return</span> do_cl_an; }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#af214bcd6d2a80ad11c8e4b1259436042">  262</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#af214bcd6d2a80ad11c8e4b1259436042">setIncl_surface</a>(<span class="keywordtype">bool</span> v){ incl_surface = v; }</div>
<div class="line"><a name="l00263"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a42949b43ebf21c5e5e47ce04b68a6df6">  263</a></span>&#160;      <span class="keywordtype">bool</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a42949b43ebf21c5e5e47ce04b68a6df6">getIncl_surface</a>(){ <span class="keywordflow">return</span> incl_surface; }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      </div>
<div class="line"><a name="l00265"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a954078a60e774682c89ae8dee7ad986a">  265</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a954078a60e774682c89ae8dee7ad986a">setD_min</a>(<span class="keywordtype">int</span> v){ d_min = v; }</div>
<div class="line"><a name="l00266"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a20425eb303d4313c79c502714df85856">  266</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a20425eb303d4313c79c502714df85856">getD_min</a>(){ <span class="keywordflow">return</span> d_min; }</div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#aa951d35d65adde54a1468a13e078c132">  267</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#aa951d35d65adde54a1468a13e078c132">setD_max</a>(<span class="keywordtype">int</span> v){ d_max = v; }</div>
<div class="line"><a name="l00268"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a339506f53a6ac5043a7c4e4661cb0474">  268</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a339506f53a6ac5043a7c4e4661cb0474">getD_max</a>(){ <span class="keywordflow">return</span> d_max; }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      </div>
<div class="line"><a name="l00270"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#abdf1637e9a23d9cd30b14e4f27c59811">  270</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#abdf1637e9a23d9cd30b14e4f27c59811">setMax_Cl</a>(<span class="keywordtype">int</span> v){ max_cluster = v; }</div>
<div class="line"><a name="l00271"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a1edd6fc5127562dd1d3be5b7aa2b1467">  271</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a1edd6fc5127562dd1d3be5b7aa2b1467">getMax_Cl</a>(){ <span class="keywordflow">return</span> max_cluster; }</div>
<div class="line"><a name="l00272"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a5947355bcf799d4403db124b525dbf60">  272</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a5947355bcf799d4403db124b525dbf60">setNum_of_Cl</a>(<span class="keywordtype">int</span> v){ number_of_clust = v; }</div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#af1010e536fa225aa271faedaa5289226">  273</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#af1010e536fa225aa271faedaa5289226">getNum_of_Cl</a>(){ <span class="keywordflow">return</span> number_of_clust; }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">       * It is efficient only when communications are optimized.</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">       */</span></div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a49f576d41481b37f36b8e3255b5d7e05">  277</a></span>&#160;      <a class="code" href="classespressopp_1_1RealND.html">RealND</a> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a49f576d41481b37f36b8e3255b5d7e05">computeRaw</a>() {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        opp_map.clear();</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        pairs.clear();</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        shared_ptr&lt; storage::Storage &gt; stor = getSystem()-&gt;storage;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        shared_ptr&lt; mpi::communicator &gt; cmm = getSystem()-&gt;comm;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordtype">int</span> this_node = cmm -&gt; rank();</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="comment">// iterate over local particles, create a map of additional properties</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <a class="code" href="structespressopp_1_1CellList.html">CellList</a> cells_loc = stor-&gt;getLocalCells();</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html" title="Iterates all Particles in a list of cells.">CellListIterator</a> cit(cells_loc); !cit.<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html#a54cf0404d9ec51872b2e0f27abeb2ba8">isDone</a>(); ++cit) {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;          <a class="code" href="structespressopp_1_1Particle.html">Particle</a>&amp; p = *cit;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          opp_map.insert( make_pair(p.<a class="code" href="structespressopp_1_1Particle.html#acab76a3b7f29602f560f8c81b8c18099">id</a>(), <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>(angular_momentum, p.<a class="code" href="structespressopp_1_1Particle.html#acab76a3b7f29602f560f8c81b8c18099">id</a>()) ) );</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        }</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="comment">// create pairs</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="structespressopp_1_1CellList.html">CellList</a> cells_real = stor-&gt;getRealCells();</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="classespressopp_1_1iterator_1_1CellListAllPairsIterator.html">CellListAllPairsIterator</a> it(cells_real); it.<a class="code" href="classespressopp_1_1iterator_1_1CellListAllPairsIterator.html#ad2254fe507d4dcbf6371007cd6f34d9b">isValid</a>(); ++it) {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          <a class="code" href="classespressopp_1_1Real3D.html">Real3D</a> r = it-&gt;first-&gt;position() - it-&gt;second-&gt;position();</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> dist_sq = r.<a class="code" href="classespressopp_1_1Real3D.html#a9eaf1e3703dd6a7e6e447b59eb98e553">sqr</a>();</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          <span class="comment">// setup NN list within cutoff</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          <span class="keywordflow">if</span> (dist_sq &lt;= cutoff_sq){</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            pairs.insert( make_pair( it-&gt;first-&gt;id(), it-&gt;second-&gt;id() ) );</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i1 = &amp;(opp_map.find( it-&gt;first-&gt;id() ))-&gt;second;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i2 = &amp;(opp_map.find( it-&gt;second-&gt;id() ))-&gt;second;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af3f4f0deb34dfc670de92425c78564e4">insertNN</a>( it-&gt;second-&gt;id() );</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af3f4f0deb34dfc670de92425c78564e4">insertNN</a>( it-&gt;first-&gt;id() );</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">dcomplex</a> tmpVar = SphHarm(angular_momentum, 0, r);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">dcomplex</a> tmpVar1 = SphHarm(angular_momentum, 0, (-1)*r);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa5f03d5a021f790058ac62ef3e098f50">setQlm</a>( 0, (opp_i1-&gt; getQlm(0) + tmpVar) );</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa5f03d5a021f790058ac62ef3e098f50">setQlm</a>( 0, (opp_i2-&gt; getQlm(0) + tmpVar1) );</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = 1; m &lt;= angular_momentum; m++) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;              tmpVar = SphHarm(angular_momentum, m, r);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;              tmpVar1 = SphHarm(angular_momentum, m, (-1)*r);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;              opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa5f03d5a021f790058ac62ef3e098f50">setQlm</a>( m, (opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a156bdc65d2b00091c8892f21d93c62ad">getQlm</a>(m) + tmpVar) );</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;              opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa5f03d5a021f790058ac62ef3e098f50">setQlm</a>( m, (opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a156bdc65d2b00091c8892f21d93c62ad">getQlm</a>(m) + tmpVar1) );</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;              <a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">dcomplex</a> conj_tmpVar = pow(-1.0, (<a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a>)m) * conj( tmpVar );</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;              <a class="code" href="OrderParameter_8hpp.html#a4b7f571699d1ce9734a7595bcf924648">dcomplex</a> conj_tmpVar1 = pow(-1.0, (<a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a>)m) * conj( tmpVar1 );</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;              opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa5f03d5a021f790058ac62ef3e098f50">setQlm</a>( -m, (opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a156bdc65d2b00091c8892f21d93c62ad">getQlm</a>(-m) + conj_tmpVar) );</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;              opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa5f03d5a021f790058ac62ef3e098f50">setQlm</a>( -m, (opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a156bdc65d2b00091c8892f21d93c62ad">getQlm</a>(-m) + conj_tmpVar1) );</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;          }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="comment">// here communicate, send all ghost info </span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="comment">//   TODO not the best way all to all communication.</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        vector &lt;OrderParticleProps&gt; sendGhostInfo;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">for</span>(boost::unordered_multimap&lt;int, OrderParticleProps&gt;::iterator opm = opp_map.begin(); opm!=opp_map.end(); ++opm){</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;          <span class="keywordtype">int</span> <span class="keywordtype">id</span> = (*opm).first;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;          <span class="keywordflow">if</span>( !stor-&gt;lookupRealParticle(<span class="keywordtype">id</span>) ){</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;op = (*opm).second;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordflow">if</span>( !op.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#acc997cda69a26cda2e9a9c69a83b2787">getNumNN</a>()==0 ) sendGhostInfo.push_back( (*opm).second );</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="keywordtype">int</span> maxSize, vecSize  = sendGhostInfo.size();</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        mpi::all_reduce( *cmm, vecSize, maxSize, mpi::maximum&lt;int&gt;() );</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordflow">while</span>(sendGhostInfo.size()&lt;maxSize) sendGhostInfo.push_back( <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>() );</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        vector&lt; OrderParticleProps &gt; totID;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        boost::mpi::all_gather( *getSystem()-&gt;comm, &amp;sendGhostInfo[0], maxSize, totID);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="comment">// TODO use set instead of vector</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        vector&lt;int&gt; realHere;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">for</span>(vector&lt;OrderParticleProps&gt;::iterator it = totID.begin(); it!=totID.end(); ++it){</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;gop = *it;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;          <span class="keywordflow">if</span>( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>()!=-1 &amp;&amp; stor-&gt;lookupRealParticle( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>() ) ){</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="keywordflow">if</span>( find( realHere.begin(), realHere.end(), gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>() ) == realHere.end() )</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;              realHere.push_back( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>() );</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i = &amp;(opp_map.find( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>() ))-&gt;second;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a119d9f5c9c5db2033c1d9811da7693b9">addQlmVector</a>( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01e07544bf75b9315c62b91cdaeaec3d">getQlmVector</a>() );</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="keywordtype">int</span> numPadd = gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#acc997cda69a26cda2e9a9c69a83b2787">getNumNN</a>();</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span>  i = 0; i&lt; numPadd; i++){</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;              opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af3f4f0deb34dfc670de92425c78564e4">insertNN</a>( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#afee8adb7385085c898d4746f24498944">getNN</a>(i) );</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;          }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="comment">// loop over all real particles and calculate SumQlm</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html" title="Iterates all Particles in a list of cells.">CellListIterator</a> cit(cells_real); !cit.<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html#a54cf0404d9ec51872b2e0f27abeb2ba8">isDone</a>(); ++cit) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="comment">//for(CellListIterator cit(cells_loc); !cit.isDone(); ++cit) {</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;          <a class="code" href="structespressopp_1_1Particle.html">Particle</a>&amp; p = *cit;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i = &amp;( opp_map.find( p.<a class="code" href="structespressopp_1_1Particle.html#acab76a3b7f29602f560f8c81b8c18099">id</a>() ) )-&gt;second;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;          opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a02e3def57d0578730ac38539ccc4953d">calculateSumQlm</a>();</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="comment">// communicate back info to ghost particles</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        sendGhostInfo.clear();</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordflow">for</span>(vector&lt;int&gt;::iterator it = realHere.begin(); it!=realHere.end(); ++it){</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          sendGhostInfo.push_back( opp_map.find( *it )-&gt;second );</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        </div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        maxSize, vecSize  = sendGhostInfo.size();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        mpi::all_reduce( *cmm, vecSize, maxSize, mpi::maximum&lt;int&gt;() );</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordflow">while</span>(sendGhostInfo.size()&lt;maxSize) sendGhostInfo.push_back( <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>() );</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        totID.clear();</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        boost::mpi::all_gather( *cmm, &amp;sendGhostInfo[0], sendGhostInfo.size(), totID);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="keywordflow">for</span>(vector&lt;OrderParticleProps&gt;::iterator it = totID.begin(); it!=totID.end(); ++it){</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;gop = *it;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;          <span class="keywordflow">if</span>( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>()!=-1 &amp;&amp; stor-&gt;lookupGhostParticle( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>() ) ){</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            (opp_map.find( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>() ))-&gt;second = gop;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;          }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        }</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="comment">// loop over pairs</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordflow">for</span>(boost::unordered_multimap&lt;int, int&gt;::iterator pit = pairs.begin(); pit != pairs.end(); ++pit){</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;          <span class="keywordtype">int</span> first = (*pit).first;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;          <span class="keywordtype">int</span> second = (*pit).second;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i1 = &amp;(opp_map.find( first ))-&gt;second;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i2 = &amp;(opp_map.find( second ))-&gt;second;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;          <span class="comment">// checking 0 sum Qlm</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;          <span class="keywordflow">if</span>(opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a76253a92836e0046fdcff319af854cb0">getSumQlm</a>() == 0){</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            cerr&lt;&lt;<span class="stringliteral">&quot; Bead2: &quot;</span>&lt;&lt; second &lt;&lt; <span class="stringliteral">&quot; in pair has 0 sum: &quot;</span>&lt;&lt; opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a76253a92836e0046fdcff319af854cb0">getSumQlm</a>()&lt;&lt;endl;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;          }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          <span class="keywordflow">if</span>(opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a76253a92836e0046fdcff319af854cb0">getSumQlm</a>() == 0){</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            cerr&lt;&lt;<span class="stringliteral">&quot; Bead1: &quot;</span>&lt;&lt; first &lt;&lt; <span class="stringliteral">&quot; in pair has 0 sum: &quot;</span>&lt;&lt; opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a76253a92836e0046fdcff319af854cb0">getSumQlm</a>()&lt;&lt;endl;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = -angular_momentum; m &lt;= angular_momentum; m++) {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> d1 = (opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a156bdc65d2b00091c8892f21d93c62ad">getQlm</a>(m) * conj( opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a156bdc65d2b00091c8892f21d93c62ad">getQlm</a>(m) )).real() / opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a76253a92836e0046fdcff319af854cb0">getSumQlm</a>();</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af5d5f4d85e487d62d4afe19ffe22dcb6">setD</a>( opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">getD</a>() + d1 );</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <a class="code" href="namespaceespressopp.html#a02c52392218b6989cf946062db1cd110">real</a> d2 = (opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a156bdc65d2b00091c8892f21d93c62ad">getQlm</a>(m) * conj( opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a156bdc65d2b00091c8892f21d93c62ad">getQlm</a>(m) )).real() / opp_i1-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a76253a92836e0046fdcff319af854cb0">getSumQlm</a>();</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af5d5f4d85e487d62d4afe19ffe22dcb6">setD</a>( opp_i2-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">getD</a>() + d2 );</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="comment">// communicate D information</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        sendGhostInfo.clear();</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">for</span>(boost::unordered_multimap&lt;int, OrderParticleProps&gt;::iterator opm = opp_map.begin(); opm!=opp_map.end(); ++opm){</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;          <span class="keywordtype">int</span> <span class="keywordtype">id</span> = (*opm).first;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;          <span class="keywordflow">if</span>( stor-&gt;lookupGhostParticle(<span class="keywordtype">id</span>) ){</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;op = (*opm).second;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="keywordflow">if</span>( !op.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#acc997cda69a26cda2e9a9c69a83b2787">getNumNN</a>()==0 ) sendGhostInfo.push_back( (*opm).second );</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;          }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        maxSize, vecSize  = sendGhostInfo.size();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        mpi::all_reduce( *cmm, vecSize, maxSize, mpi::maximum&lt;int&gt;() );</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">while</span>(sendGhostInfo.size()&lt;maxSize) sendGhostInfo.push_back( <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>() );</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        totID.clear();</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        boost::mpi::all_gather( *getSystem()-&gt;comm, &amp;sendGhostInfo[0], maxSize, totID);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">for</span>(vector&lt;OrderParticleProps&gt;::iterator it = totID.begin(); it!=totID.end(); ++it){</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;gop = *it;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;          <span class="keywordflow">if</span>( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>()!=-1 &amp;&amp; stor-&gt;lookupRealParticle( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>() ) ){</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;          <span class="comment">//if( gop.getPID()!=-1 &amp;&amp; stor-&gt;lookupLocalParticle( gop.getPID() ) ){</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i = &amp;(opp_map.find( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>() ))-&gt;second;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af5d5f4d85e487d62d4afe19ffe22dcb6">setD</a>(  opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">getD</a>() + gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">getD</a>() );</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;          }</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="comment">// ------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="comment">// loop over particles and normalize d</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html" title="Iterates all Particles in a list of cells.">CellListIterator</a> cit(cells_real); !cit.<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html#a54cf0404d9ec51872b2e0f27abeb2ba8">isDone</a>(); ++cit) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;          <a class="code" href="structespressopp_1_1Particle.html">Particle</a>&amp; p = *cit;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;          <span class="keywordtype">int</span> pid = p.<a class="code" href="structespressopp_1_1Particle.html#acab76a3b7f29602f560f8c81b8c18099">id</a>();</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i = &amp;(opp_map.find( pid ))-&gt;second;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;          </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;          <span class="comment">//catch particles without neighbors </span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;          <span class="keywordflow">if</span> ( opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#acc997cda69a26cda2e9a9c69a83b2787">getNumNN</a>() == 0 ){</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            cerr &lt;&lt; <span class="stringliteral">&quot;Bead: &quot;</span>&lt;&lt; pid &lt;&lt; <span class="stringliteral">&quot; has no neighbors - setting OP to zero&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af5d5f4d85e487d62d4afe19ffe22dcb6">setD</a>( 0.0 );</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;          }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;          </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;          opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#af5d5f4d85e487d62d4afe19ffe22dcb6">setD</a>( opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">getD</a>() / opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a76253a92836e0046fdcff319af854cb0">getSumQlm</a>() / opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#acc997cda69a26cda2e9a9c69a83b2787">getNumNN</a>() );</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;          </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;          <span class="comment">//check for NAN</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;          <span class="keywordflow">if</span> ( opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">getD</a>() != opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">getD</a>() ) {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            cerr &lt;&lt; <span class="stringliteral">&quot;Current bead: &quot;</span> &lt;&lt; p.<a class="code" href="structespressopp_1_1Particle.html#acab76a3b7f29602f560f8c81b8c18099">id</a>() &lt;&lt; endl;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            cerr &lt;&lt; <span class="stringliteral">&quot;qlmSumSqrt: &quot;</span> &lt;&lt; opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a76253a92836e0046fdcff319af854cb0">getSumQlm</a>() &lt;&lt; endl;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            cerr &lt;&lt; <span class="stringliteral">&quot;near neibs: &quot;</span> &lt;&lt; opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#acc997cda69a26cda2e9a9c69a83b2787">getNumNN</a>() &lt;&lt; endl;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;result: NAN - this should never happen...&quot;</span> );</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;          }</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;           </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;          <span class="comment">//ret[pid] = opp_i-&gt;getD();</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <a class="code" href="classespressopp_1_1RealND.html">RealND</a> ret(1, 0.0);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      </div>
<div class="line"><a name="l00476"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a6f40a4cb215e7c21e62930e96ec69af6">  476</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a6f40a4cb215e7c21e62930e96ec69af6">define_solid</a>(){</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <a class="code" href="structespressopp_1_1CellList.html">CellList</a> cells = getSystem()-&gt;storage-&gt;getRealCells();</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html" title="Iterates all Particles in a list of cells.">CellListIterator</a> cit(cells); !cit.<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html#a54cf0404d9ec51872b2e0f27abeb2ba8">isDone</a>(); ++cit) {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;          <a class="code" href="structespressopp_1_1Particle.html">Particle</a>&amp; p = *cit;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;          <span class="keywordtype">int</span> pid = p.<a class="code" href="structespressopp_1_1Particle.html#acab76a3b7f29602f560f8c81b8c18099">id</a>();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i = &amp;(opp_map.find( pid ))-&gt;second;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;          <span class="keywordflow">if</span>( opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">getD</a>() &gt;= d_min &amp;&amp; opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a01ceaa0fa1ba414bd2b0d91f1169534f">getD</a>() &lt;= d_max ){</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            opp_i-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a4a3eb37b6aca1da43a0fc8a95f964285">setSolid</a>( <span class="keyword">true</span> );</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;          }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordflow">if</span>(incl_surface){</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          <span class="comment">// -----------------------------------------------------------------------</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;          <span class="comment">// send ghost info</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;          shared_ptr&lt; mpi::communicator &gt; cmm = getSystem()-&gt;comm;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;          vector &lt;OrderParticleProps&gt; sendGhostInfo;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;          <span class="keywordflow">for</span>(<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html" title="Iterates all Particles in a list of cells.">CellListIterator</a> cit(cells); !cit.<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html#a54cf0404d9ec51872b2e0f27abeb2ba8">isDone</a>(); ++cit) {</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            <a class="code" href="structespressopp_1_1Particle.html">Particle</a>&amp; p = *cit;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="keywordtype">int</span> pid = p.<a class="code" href="structespressopp_1_1Particle.html#acab76a3b7f29602f560f8c81b8c18099">id</a>();</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i = &amp;(opp_map.find( pid ))-&gt;second;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            sendGhostInfo.push_back( *opp_i );</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;          }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;          <span class="keywordtype">int</span> maxSize, vecSize  = sendGhostInfo.size();</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          mpi::all_reduce( *cmm, vecSize, maxSize, mpi::maximum&lt;int&gt;() );</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          <span class="keywordflow">while</span>(sendGhostInfo.size()&lt;maxSize) sendGhostInfo.push_back( <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>() );</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          vector&lt; OrderParticleProps &gt; totID;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          mpi::all_gather( *cmm, &amp;sendGhostInfo[0], maxSize, totID);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;          <span class="keywordflow">for</span>(vector&lt;OrderParticleProps&gt;::iterator it = totID.begin(); it!=totID.end(); ++it){</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;gop = *it;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            <span class="keywordflow">if</span>( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>()!=-1 ){</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;              <span class="keywordflow">if</span>( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad2c4a4d657f9e6b8a5fd18038e06749c">getSolid</a>() &amp;&amp; !gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">getSurface</a>() ){</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <span class="keywordtype">int</span> nnn = gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#acc997cda69a26cda2e9a9c69a83b2787">getNumNN</a>();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;nnn; i++){</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    <span class="keywordflow">if</span>( getSystem()-&gt;storage-&gt;lookupRealParticle( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#afee8adb7385085c898d4746f24498944">getNN</a>(i) ) ){</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                      <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> *opp_i_surf = &amp;(opp_map.find( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#afee8adb7385085c898d4746f24498944">getNN</a>(i) ))-&gt;second;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                      <span class="keywordflow">if</span>( !opp_i_surf-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad2c4a4d657f9e6b8a5fd18038e06749c">getSolid</a>() ){</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                        opp_i_surf-&gt;<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#adad7f9bdce7744465f0aa018c439380c">setSurface</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                      }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                    }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;              }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;          }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;          <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      </div>
<div class="line"><a name="l00539"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a659c40c281de263c5de14e3df193e0ac">  539</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a659c40c281de263c5de14e3df193e0ac">cluster_analysis</a>(){</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        wrong_label_local0.clear();</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        outside_id.clear();</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        wrong_label_local.clear();</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        local_cluster_search();</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">        CellList cells = getSystem()-&gt;storage-&gt;getRealCells();</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">        for(CellListIterator cit(cells); !cit.isDone(); ++cit) {</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">          Particle&amp; p = *cit;</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">          int pid = p.id();</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">          OrderParticleProps &amp;opp_i = (opp_map.find( pid ))-&gt;second;</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">          if ( opp_i.getLabel() &gt; -1){</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">            cout&lt;&lt; &quot;cpu:  &quot; &lt;&lt; getSystem()-&gt;comm-&gt;rank() &lt;&lt; &quot;  pid: &quot;&lt;&lt; pid&lt;&lt; &quot;  label:&quot;&lt;&lt; opp_i.getLabel() &lt;&lt; endl;</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">          }</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        global_cluster_analysis();</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        biggest_cluster();</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a20e497db1dd1966a2712696bb9de42e8">  563</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a20e497db1dd1966a2712696bb9de42e8">global_cluster_analysis</a>(){</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="comment">// ***************** communicate outside_id</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordtype">int</span> locSize = outside_id.size(); <span class="keywordtype">int</span> maxSize=0;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        mpi::all_reduce(*getSystem()-&gt;comm, locSize, maxSize, mpi::maximum&lt;int&gt;());</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html">communicate_label</a> cccc; cccc.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#a6f51bac964c0e0311bcc8a2f307136eb">pid</a> = -1; cccc.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ac51bedc36455cf4a22d4c6707effb62f">label</a> = -1; cccc.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ae619749085f3bf77fd6ac89d237d3ede">cpu</a> = -1;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keywordflow">while</span>(outside_id.size()&lt;maxSize) outside_id.push_back( cccc );</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordtype">int</span> numProc = getSystem()-&gt;comm-&gt;size();</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        vector&lt;communicate_label&gt; tot_label_info = vector&lt;communicate_label&gt;( numProc * maxSize, cccc );</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        mpi::all_gather( *getSystem()-&gt;comm, &amp;outside_id[0], maxSize, tot_label_info);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="comment">// ***************** communicate outside_id. END</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;     </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">for</span>(vector&lt;communicate_label&gt;::iterator it = tot_label_info.begin(); it!=tot_label_info.end(); ++it){</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;          <a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html">communicate_label</a> &amp;cur_lab = *it;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          <span class="keywordflow">if</span>( cur_lab.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ae619749085f3bf77fd6ac89d237d3ede">cpu</a> != -1 &amp;&amp; getSystem()-&gt;storage-&gt;lookupRealParticle( cur_lab.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#a6f51bac964c0e0311bcc8a2f307136eb">pid</a> ) ){</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;              <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;opp = (opp_map.find( cur_lab.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#a6f51bac964c0e0311bcc8a2f307136eb">pid</a> ))-&gt;second;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;              <span class="keywordtype">int</span> labll = opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>();</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;              <span class="keywordflow">if</span> ( (opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad2c4a4d657f9e6b8a5fd18038e06749c">getSolid</a>() || opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">getSurface</a>() ) ){</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <span class="keywordtype">int</span> min_lab=0, max_lab=0;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                <span class="keywordflow">if</span> ( labll == -1 &amp;&amp; opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">getSurface</a>()){</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                  opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a9624dec86b45ebdeb402ec2fb273b85e">setLabel</a>( cur_lab.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ac51bedc36455cf4a22d4c6707effb62f">label</a> );</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(labll != -1 &amp;&amp; opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">getSurface</a>() ){</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                  <span class="comment">// TODO add action if meet another label</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                  <span class="comment">//min_lab = min(labll, cur_lab.label);</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                  <span class="comment">//max_lab = max(labll, cur_lab.label);</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                  <span class="comment">//relab(min_lab, max_lab);</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                  <span class="comment">//relab11(min_lab, max_lab);</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(labll != cur_lab.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ac51bedc36455cf4a22d4c6707effb62f">label</a>){</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                  <span class="comment">// TODO add action if meet another label</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                  min_lab = min(labll, cur_lab.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ac51bedc36455cf4a22d4c6707effb62f">label</a>);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                  max_lab = max(labll, cur_lab.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ac51bedc36455cf4a22d4c6707effb62f">label</a>);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                  <span class="comment">//relab(min_lab, max_lab);</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                  relab11(min_lab, max_lab);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">                else{</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">                  cout&lt;&lt;&quot;!!!WRONG global_cluster_analysis!!!  cpu: &quot;&lt;&lt; getSystem()-&gt;comm-&gt;rank() &lt;&lt;</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">                        &quot; particle: &quot;&lt;&lt; opp.getPID()&lt;&lt; </span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">                        &quot; is &quot;&lt;&lt;  opp.getSolid() &lt;&lt; &quot;  &quot; &lt;&lt; opp.getSurface() &lt;&lt;</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">                        &quot; and has label:  &quot;&lt;&lt; opp.getLabel() &lt;&lt; endl;</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">                */</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;              }</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;          }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        vector&lt;int&gt; wl, cl; <span class="comment">// wrong and correct labels</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">for</span>(unordered_map&lt;int, int&gt;::iterator it = wrong_label_local.begin(); </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                it!=wrong_label_local.end(); ++it ){</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;          wl.push_back( (*it).first );</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          cl.push_back( (*it).second );</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="comment">// ******* collect all wrong labels to 0 cpu</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        locSize = wl.size(); maxSize=0;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        mpi::all_reduce(*getSystem()-&gt;comm, locSize, maxSize, mpi::maximum&lt;int&gt;());</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="keywordflow">while</span>(wl.size()&lt;maxSize){ wl.push_back( -1 ); cl.push_back( -1 ); }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        numProc = getSystem()-&gt;comm-&gt;size();</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        vector&lt;int&gt; totWL = vector&lt;int&gt;( numProc * maxSize, -1 );</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        vector&lt;int&gt; totCL = vector&lt;int&gt;( numProc * maxSize, -1 );</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        mpi::gather( *getSystem()-&gt;comm, &amp;wl[0], maxSize, totWL, 0);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        mpi::gather( *getSystem()-&gt;comm, &amp;cl[0], maxSize, totCL, 0);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        wrong_label_local0.clear();</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        wl.clear(); cl.clear();</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        vector&lt;int&gt; wl0, cl0; <span class="comment">// wrong and correct labels</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">if</span>( getSystem()-&gt;comm-&gt;rank()==0 ){</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;totWL.size(); i++){</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <span class="keywordflow">if</span>( totWL[i]&gt;-1 &amp;&amp; totCL[i]&gt;-1 ){</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;              relab22(totCL[i], totWL[i]);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;          </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;          <span class="keywordflow">for</span>(unordered_map&lt;int, int&gt;::iterator it = wrong_label_local0.begin(); </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                  it!=wrong_label_local0.end(); ++it ){</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            wl0.push_back( (*it).first );</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            cl0.push_back( (*it).second );</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;          }</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordtype">int</span> vec_size;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">if</span>( getSystem()-&gt;comm-&gt;rank()==0 ){</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;          vec_size=wl0.size();</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        mpi::broadcast( *getSystem()-&gt;comm, vec_size, 0);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">if</span>( getSystem()-&gt;comm-&gt;rank()!=0 ){</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;          wl0 = vector&lt;int&gt;(vec_size, -1);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;          cl0 = vector&lt;int&gt;(vec_size, -1);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        }</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        mpi::broadcast( *getSystem()-&gt;comm, &amp;wl0[0], wl0.size(), 0);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        mpi::broadcast( *getSystem()-&gt;comm, &amp;cl0[0], cl0.size(), 0);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        wrong_label_local.clear();</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;wl0.size(); i++){</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;          wrong_label_local.insert( make_pair(wl0[i], cl0[i]) );</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        relabel_particles();</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      </div>
<div class="line"><a name="l00679"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a0656b13c3c7a506d75a7183c7a660094">  679</a></span>&#160;      unordered_map&lt; int, int &gt; <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a0656b13c3c7a506d75a7183c7a660094">wrong_label_local0</a>;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      </div>
<div class="line"><a name="l00681"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a51c924ef445524b273c652a172862fb8">  681</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a51c924ef445524b273c652a172862fb8">relab22</a>(<span class="keywordtype">int</span> new_lab, <span class="keywordtype">int</span> old_lab){</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">if</span>( wrong_label_local0.find( old_lab ) == wrong_label_local0.end() ){</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;          wrong_label_local0.insert( make_pair(old_lab, new_lab) );</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( wrong_label_local0.find( old_lab ) )-&gt;second != new_lab ){</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;          <span class="keywordtype">int</span> correct_old = ( wrong_label_local0.find( old_lab ) )-&gt;second;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;          </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;          <span class="keywordtype">int</span> mmin = min(correct_old, new_lab);</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          <span class="keywordtype">int</span> mmax = max(correct_old, new_lab);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;          </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          relab22(mmin, mmax);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      </div>
<div class="line"><a name="l00696"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#ab7f712957ab2bce4ae91b1907f034df1">  696</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#ab7f712957ab2bce4ae91b1907f034df1">local_cluster_search</a>(){</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordtype">int</span> num_proc = getSystem()-&gt;comm-&gt;size();</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordtype">int</span> loc_proc = getSystem()-&gt;comm-&gt;rank();</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordtype">int</span> i_label_local = 0; <span class="comment">// local increment</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="keywordtype">int</span> cur_label = loc_proc + i_label_local * num_proc; <span class="comment">// unique label for each cpu</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        outside_id.clear();</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <a class="code" href="structespressopp_1_1CellList.html">CellList</a> cells = getSystem()-&gt;storage-&gt;getRealCells();</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html" title="Iterates all Particles in a list of cells.">CellListIterator</a> cit(cells); !cit.<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html#a54cf0404d9ec51872b2e0f27abeb2ba8">isDone</a>(); ++cit) {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;          <a class="code" href="structespressopp_1_1Particle.html">Particle</a>&amp; p = *cit;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;          <span class="keywordtype">int</span> pid = p.<a class="code" href="structespressopp_1_1Particle.html#acab76a3b7f29602f560f8c81b8c18099">id</a>();</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;opp_i = (opp_map.find( pid ))-&gt;second;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;          <span class="keywordflow">if</span> ( opp_i.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>() == -1 &amp;&amp; opp_i.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad2c4a4d657f9e6b8a5fd18038e06749c">getSolid</a>() &amp;&amp; !(opp_i.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">getSurface</a>()) ){</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">//          if ( opp_i.getLabel() == -1 &amp;&amp; (opp_i.getSolid() || opp_i.getSurface()) ){</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            cluster_walk(pid, cur_label, opp_i);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            i_label_local++;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            cur_label=loc_proc + i_label_local * num_proc;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        relabel_particles();</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      }</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">// ***************************************************************************************</span></div>
<div class="line"><a name="l00722"></a><span class="lineno"><a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html">  722</a></span>&#160;      <span class="keyword">struct </span><a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html">communicate_label</a>{</div>
<div class="line"><a name="l00723"></a><span class="lineno"><a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#a6f51bac964c0e0311bcc8a2f307136eb">  723</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#a6f51bac964c0e0311bcc8a2f307136eb">pid</a>;</div>
<div class="line"><a name="l00724"></a><span class="lineno"><a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ac51bedc36455cf4a22d4c6707effb62f">  724</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ac51bedc36455cf4a22d4c6707effb62f">label</a>;</div>
<div class="line"><a name="l00725"></a><span class="lineno"><a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ae619749085f3bf77fd6ac89d237d3ede">  725</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ae619749085f3bf77fd6ac89d237d3ede">cpu</a>;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Archive&gt;</div>
<div class="line"><a name="l00728"></a><span class="lineno"><a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ae521f3ae3762ecd26dd2a42bf11bbc40">  728</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ae521f3ae3762ecd26dd2a42bf11bbc40">serialize</a>(Archive&amp; ar, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> version){</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;          ar &amp; pid;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;          ar &amp; label;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;          ar &amp; cpu;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        }        </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      };</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      </div>
<div class="line"><a name="l00735"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a51424521cc8b58a60a5a4e008d40a243">  735</a></span>&#160;      vector&lt; communicate_label &gt; <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a51424521cc8b58a60a5a4e008d40a243">outside_id</a>;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      </div>
<div class="line"><a name="l00737"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a8307ba4d772483bbb9d2552e8c0e4b4a">  737</a></span>&#160;      unordered_map&lt; int, int &gt; <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a8307ba4d772483bbb9d2552e8c0e4b4a">wrong_label_local</a>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">// ***************************************************************************************</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      </div>
<div class="line"><a name="l00741"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a82f61e3809dd072f73977e142d18397b">  741</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a82f61e3809dd072f73977e142d18397b">cluster_walk</a>(<span class="keywordtype">int</span> pid, <span class="keywordtype">int</span> cur_lab, <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;opp){</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a9624dec86b45ebdeb402ec2fb273b85e">setLabel</a>(cur_lab);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="keywordtype">int</span> num_nn = opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#acc997cda69a26cda2e9a9c69a83b2787">getNumNN</a>();</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j=0; j&lt; num_nn; j++) {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          <span class="keywordtype">int</span> pid_neib = opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#afee8adb7385085c898d4746f24498944">getNN</a>(j);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          <span class="keywordflow">if</span>( !getSystem()-&gt;storage-&gt;lookupRealParticle( pid_neib ) ){</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            <a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html">communicate_label</a> cc;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            cc.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#a6f51bac964c0e0311bcc8a2f307136eb">pid</a> = pid_neib;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            cc.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ac51bedc36455cf4a22d4c6707effb62f">label</a> = cur_lab;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            cc.<a class="code" href="structespressopp_1_1analysis_1_1OrderParameter_1_1communicate__label.html#ae619749085f3bf77fd6ac89d237d3ede">cpu</a> = getSystem()-&gt;comm-&gt;rank();</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            outside_id.push_back( cc );</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;opp_neib = (opp_map.find( pid_neib ))-&gt;second;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <span class="keywordtype">int</span> lab_neib = opp_neib.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>();</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="keywordflow">if</span> ( lab_neib != cur_lab &amp;&amp; pid_neib!=pid &amp;&amp;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                    opp_neib.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad2c4a4d657f9e6b8a5fd18038e06749c">getSolid</a>() &amp;&amp; !(opp_neib.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">getSurface</a>()) ){</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">            if ( lab_neib != cur_lab &amp;&amp; pid_neib!=pid &amp;&amp;</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">                    (opp_neib.getSolid() || opp_neib.getSurface()) ){</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;              <span class="keywordtype">int</span> min_lab=0, max_lab=0;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;              <span class="keywordflow">if</span> ( lab_neib == -1){</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                min_lab = cur_lab;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;              }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;              <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                min_lab = min(lab_neib, cur_lab);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                max_lab = max(lab_neib, cur_lab);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                relab11(min_lab, max_lab);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;              }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;              cluster_walk(pid_neib, min_lab, opp_neib);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( opp_neib.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">getSurface</a>() &amp;&amp; lab_neib==-1){</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;              opp_neib.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a9624dec86b45ebdeb402ec2fb273b85e">setLabel</a>(cur_lab);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;          </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      </div>
<div class="line"><a name="l00788"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a92d45672f1151b44f87594727624620c">  788</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a92d45672f1151b44f87594727624620c">relab</a>(<span class="keywordtype">int</span> new_lab, <span class="keywordtype">int</span> old_lab){</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordflow">for</span>(boost::unordered_multimap&lt;int, OrderParticleProps&gt;::iterator opm = opp_map.begin(); opm!=opp_map.end(); ++opm){</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;opp = (*opm).second;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;          <span class="keywordflow">if</span>( opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>() == old_lab ){</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a9624dec86b45ebdeb402ec2fb273b85e">setLabel</a>(new_lab);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;          }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      }</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#ada982674ec5a35c4d1ce7a02290788ef">  797</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#ada982674ec5a35c4d1ce7a02290788ef">relab11</a>(<span class="keywordtype">int</span> new_lab, <span class="keywordtype">int</span> old_lab){</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">if</span>( wrong_label_local.find( old_lab ) == wrong_label_local.end() ){</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;          wrong_label_local.insert( make_pair(old_lab, new_lab) );</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        }</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( wrong_label_local.find( old_lab ) )-&gt;second != new_lab ){</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;          <span class="keywordtype">int</span> correct_old = ( wrong_label_local.find( old_lab ) )-&gt;second;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;          </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          <span class="keywordtype">int</span> mmin = min(correct_old, new_lab);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;          <span class="keywordtype">int</span> mmax = max(correct_old, new_lab);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;          </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;          relab11(mmin, mmax);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        }</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;      }</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div>
<div class="line"><a name="l00811"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a8196ff23fc0e4044389ee5433e18239a">  811</a></span>&#160;      <span class="keywordtype">int</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a8196ff23fc0e4044389ee5433e18239a">getCorrectLabel</a>(<span class="keywordtype">int</span> current_label){</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">if</span>( wrong_label_local.find( current_label ) == wrong_label_local.end() ){</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          <span class="keywordflow">return</span> current_label;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          <span class="keywordflow">return</span> getCorrectLabel( (wrong_label_local.find( current_label ))-&gt;second );</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      }</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      </div>
<div class="line"><a name="l00820"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a9d3c8b1bc9ab9f06d912664017c192f7">  820</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a9d3c8b1bc9ab9f06d912664017c192f7">relabel_particles</a>(){</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keywordflow">for</span>(boost::unordered_multimap&lt;int, OrderParticleProps&gt;::iterator opm = opp_map.begin(); opm!=opp_map.end(); ++opm){</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;opp = (*opm).second;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;          <span class="keywordflow">if</span>( opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad2c4a4d657f9e6b8a5fd18038e06749c">getSolid</a>() || opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">getSurface</a>() ){</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            <span class="keywordflow">if</span>( opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>()&lt;0 &amp;&amp; opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad2c4a4d657f9e6b8a5fd18038e06749c">getSolid</a>() ){</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;              cout&lt;&lt;<span class="stringliteral">&quot;!!!relabel_particles!!!  cpu: &quot;</span>&lt;&lt; getSystem()-&gt;comm-&gt;rank() &lt;&lt;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                      <span class="stringliteral">&quot; particle: &quot;</span>&lt;&lt; opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>()&lt;&lt; </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                      <span class="stringliteral">&quot; is &quot;</span>&lt;&lt;  opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#ad2c4a4d657f9e6b8a5fd18038e06749c">getSolid</a>() &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a6fff75b13a6b1f350333e78ce2c40a62">getSurface</a>() &lt;&lt;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                      <span class="stringliteral">&quot; and has label:  &quot;</span>&lt;&lt; opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>() &lt;&lt; endl;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>()&gt;=0){</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;              opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a9624dec86b45ebdeb402ec2fb273b85e">setLabel</a>( getCorrectLabel( opp.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>() ) );</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            }</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;          }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        }</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      </div>
<div class="line"><a name="l00838"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a244c702f9dfc9e0d1484d051ed6a894c">  838</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a244c702f9dfc9e0d1484d051ed6a894c">biggest_cluster</a>(){</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        vector&lt; vector&lt;int&gt; &gt; clusters;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <a class="code" href="structespressopp_1_1CellList.html">CellList</a> cells = getSystem()-&gt;storage-&gt;getRealCells();</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        vector &lt;OrderParticleProps&gt; sendGhostInfo;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html" title="Iterates all Particles in a list of cells.">CellListIterator</a> cit(cells); !cit.<a class="code" href="classespressopp_1_1iterator_1_1CellListIterator.html#a54cf0404d9ec51872b2e0f27abeb2ba8">isDone</a>(); ++cit) {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;          <a class="code" href="structespressopp_1_1Particle.html">Particle</a>&amp; p = *cit;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;          <span class="keywordtype">int</span> pid = p.<a class="code" href="structespressopp_1_1Particle.html#acab76a3b7f29602f560f8c81b8c18099">id</a>();</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;          <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> opp_i = (opp_map.find( pid ))-&gt;second;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;          sendGhostInfo.push_back( opp_i );</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        }</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        </div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        vector&lt;int&gt; sendSizes;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="keywordtype">int</span> ss  = sendGhostInfo.size();</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        mpi::all_gather( *getSystem()-&gt;comm, ss, sendSizes);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordtype">int</span> maxSize=0;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="keywordflow">for</span>(vector&lt;int&gt;::iterator it = sendSizes.begin(); it!=sendSizes.end(); ++it){</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;          maxSize = max(maxSize, *it);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="keywordflow">while</span>(sendGhostInfo.size()&lt;maxSize) sendGhostInfo.push_back( <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>() );</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordtype">int</span> numProc = getSystem()-&gt;comm-&gt;size();</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        vector&lt;OrderParticleProps&gt; totID = vector&lt;OrderParticleProps&gt;( numProc * maxSize, <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a>() );</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        mpi::gather( *getSystem()-&gt;comm, &amp;sendGhostInfo[0], maxSize, totID, 0);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keywordflow">if</span>( getSystem()-&gt;comm-&gt;rank()==0 ){</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;          </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;          <span class="keywordflow">for</span>(vector&lt;OrderParticleProps&gt;::iterator it=totID.begin(); it!=totID.end(); ++it) {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html">OrderParticleProps</a> &amp;gop = *it;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <span class="keywordflow">if</span>(gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>()&gt;=0){</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;              </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;              <span class="keywordflow">if</span>( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>()&gt;=0 ){</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                <span class="keywordflow">while</span>( (<span class="keywordtype">int</span>)clusters.size() &lt;= (int)gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>() ) clusters.push_back( vector&lt;int&gt;(0, 0) );</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                clusters[ gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#aa1017c47fa455e02e816795b47fc92ac">getLabel</a>() ].push_back( gop.<a class="code" href="classespressopp_1_1analysis_1_1OrderParticleProps.html#a5b9e1c49d4a9e4b4b6422316373f8391">getPID</a>() );</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;              }</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;              </div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            }</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;          </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        </div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">        for(boost::unordered_multimap&lt;int, OrderParticleProps&gt;::iterator opm = opp_map.begin(); opm!=opp_map.end(); ++opm){</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">          OrderParticleProps &amp;opp = (*opm).second;</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">          </span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">          if( opp.getLabel()&gt;=0 ){</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">            while( (int)clusters.size() &lt;= (int)opp.getLabel() ){</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">              clusters.push_back( vector&lt;int&gt;(0, 0) );</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">            clusters[ opp.getLabel() ].push_back( opp.getPID() );</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">          }</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;          <span class="keywordtype">int</span> max_pos = -1;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          <span class="keywordtype">int</span> max_size = 0;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;          <span class="keywordtype">int</span> empty = 0;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;          <span class="keywordflow">for</span> (vector&lt; vector&lt;int&gt; &gt;::iterator it = clusters.begin() ; it != clusters.end(); ++it){</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            <span class="keywordflow">if</span>( max_size != max(max_size, (<span class="keywordtype">int</span>)( (*it).size() ) ) ){</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;              max_pos = it - clusters.begin();</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            max_size = max(max_size, (<span class="keywordtype">int</span>)( (*it).size() ) );</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            <span class="keywordflow">if</span>( (<span class="keywordtype">int</span>)( (*it).size() )==0 ){</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;              empty++;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;              <span class="comment">//cout&lt;&lt;&quot;  cpu: &quot;&lt;&lt; getSystem()-&gt;comm-&gt;rank() &lt;&lt;   &quot; label: &quot;&lt;&lt; (it - clusters.begin()) &lt;&lt; &quot;  is empty&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;          }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">          cout&lt;&lt;&quot;  cpu: &quot;&lt;&lt; getSystem()-&gt;comm-&gt;rank() &lt;&lt;  &quot; max pos: &quot;&lt;&lt; max_pos &lt;&lt; endl;</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">          int count=0;</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">          for (vector&lt;int&gt;::iterator it = clusters[max_pos].begin() ; it != clusters[max_pos].end(); ++it){</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">            cout&lt;&lt;count&lt;&lt;&quot;  BIGGEST CL  cpu: &quot;&lt;&lt; getSystem()-&gt;comm-&gt;rank() &lt;&lt;  &quot; id: &quot;&lt;&lt; *it &lt;&lt; endl;</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">            count++;</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment">          }</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;          <span class="keywordtype">int</span> num_clusters = clusters.size();</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;          setNum_of_Cl(num_clusters-empty);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;          setMax_Cl(max_size);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        </div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      </div>
<div class="line"><a name="l00929"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a81652e2c456e6f64ba9d180832e57e83">  929</a></span>&#160;      python::list <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a81652e2c456e6f64ba9d180832e57e83">compute</a>() {</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        python::list ret;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        </div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <a class="code" href="classespressopp_1_1RealND.html">RealND</a> res = computeRaw();</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="keywordflow">if</span>( do_cl_an ){</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;          define_solid();</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;          </div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;          cluster_analysis();</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">        CellList cells = getSystem()-&gt;storage-&gt;getRealCells();</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">        vector &lt;OrderParticleProps&gt; sendGhostInfo;</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">        for(CellListIterator cit(cells); !cit.isDone(); ++cit) {</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">          Particle&amp; p = *cit;</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">          int pid = p.id();</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">          OrderParticleProps opp_i = (opp_map.find( pid ))-&gt;second;</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">          sendGhostInfo.push_back( opp_i );</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">        </span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">        vector&lt;int&gt; sendSizes;</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">        int ss  = sendGhostInfo.size();</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">        mpi::all_gather( *getSystem()-&gt;comm, ss, sendSizes);</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">        int maxSize=0;</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">        for(vector&lt;int&gt;::iterator it = sendSizes.begin(); it!=sendSizes.end(); ++it){</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">          maxSize = max(maxSize, *it);</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">        while(sendGhostInfo.size()&lt;maxSize) sendGhostInfo.push_back( OrderParticleProps() );</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">        int numProc = getSystem()-&gt;comm-&gt;size();</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">        vector&lt;OrderParticleProps&gt; totID = vector&lt;OrderParticleProps&gt;( numProc * maxSize, OrderParticleProps() );</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">        mpi::gather( *getSystem()-&gt;comm, &amp;sendGhostInfo[0], maxSize, totID, 0);</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment">        int myN = getSystem()-&gt;storage-&gt;getNRealParticles();</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">        int num_part=0;</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment">        mpi::all_reduce(*getSystem()-&gt;comm, myN, num_part, std::plus&lt;int&gt;());</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <span class="keywordflow">if</span>( getSystem()-&gt;comm-&gt;rank()==0 ){</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;          </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">          for(vector&lt;OrderParticleProps&gt;::iterator it=totID.begin(); it!=totID.end(); ++it) {</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">            OrderParticleProps &amp;gop = *it;</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">            if(gop.getPID()&gt;=0){</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment">              python::list nn;</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">              </span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">              for(int i=0; i&lt;gop.getNumNN(); i++){</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">                nn.append( gop.getNN(i) );</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">              }</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">              </span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">              python::tuple pt = python::make_tuple( gop.getPID(), gop.getD(),</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">                      gop.getNumNN(), gop.getSolid(), gop.getSurface(), nn);</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">              ret.append( pt );</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">          }</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">          ret.sort();</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">          </span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">          cout &lt;&lt; &quot;\n   inside OP:  max_cl: &quot;&lt;&lt; getMax_Cl() &lt;&lt; &quot;  num_cl: &quot;&lt;&lt; getNum_of_Cl()&lt;&lt; endl;</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;          </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;          ret.append(getMax_Cl());</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;          ret.append(getNum_of_Cl());</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;          ret.append(0);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        </div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      }</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div>
<div class="line"><a name="l01001"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a70f11b2418de69d5046666bba78fbb5b"> 1001</a></span>&#160;      python::list <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a70f11b2418de69d5046666bba78fbb5b">getAverageValue</a>() {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        python::list ret;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">        RealND res;</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">        res = nMeasurements&gt;0 ? newAverage : 0;</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">        ret.append(res);</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment">        res = nMeasurements&gt;0 ? newVariance : 0;</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">        ret.append(sqrt(res/(nMeasurements-1)));</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      }</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      </div>
<div class="line"><a name="l01013"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a2faf4b63c4fd3331cabe204085c2f9a1"> 1013</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a2faf4b63c4fd3331cabe204085c2f9a1">resetAverage</a>() {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        newAverage   = 0;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        lastAverage  = 0;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        newVariance  = 0;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        lastVariance = 0;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      }</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div>
<div class="line"><a name="l01020"></a><span class="lineno"><a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a9bde80a0c9f59cb38e2fa870f1d79309"> 1020</a></span>&#160;      <span class="keywordtype">void</span> <a class="code" href="classespressopp_1_1analysis_1_1OrderParameter.html#a9bde80a0c9f59cb38e2fa870f1d79309">updateAverage</a>(<a class="code" href="classespressopp_1_1RealND.html">RealND</a> res) {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">        if (nMeasurements &gt; 0) {</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">          if (nMeasurements == 1) {</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">              newAverage     = res;</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">              lastAverage    = newAverage;</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">          } else {</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">              newAverage   = lastAverage  + (res - lastAverage) / nMeasurements;</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">              newVariance  = lastVariance + (res - lastAverage) * (res - newAverage);</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">              lastAverage  = newAverage;</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">              lastVariance = newVariance;</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">          }</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    };</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;}</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="preprocessor">#endif</span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 12 2016 08:26:26 for ESPResSo++ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
