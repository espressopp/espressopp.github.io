

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Adaptive Resolution Simulations &mdash; ESPResSo++ v1.9.4</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="ESPResSo++ v1.9.4" href="index.html"/>
        <link rel="up" title="Tutorial" href="tutorial.html"/>
        <link rel="next" title="Thermodynamic integration" href="tutorial.ThermodynamicIntegration.html"/>
        <link rel="prev" title="AddNewPotential" href="tutorial.AddNewPotential.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ESPResSo++
          

          
            
            <img src="_static/logo_theory_group_200x48.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.9.4
              </div>
            
          

          
<div id="searchbox" style="display: none" role="search">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="instalation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.SystemSetup.html">Basic System Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.LennardJones.html">Simple Lennard Jones System</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.LennardJones2.html">Advanced Lennard Jones System</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.PolymerMelt.html">Polymer Melt</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.AddNewPotential.html">AddNewPotential</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.AddNewPotential.html#appendices">Appendices</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Adaptive Resolution Simulations</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.ThermodynamicIntegration.html">Thermodynamic integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="classdescription.html">User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_help.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="team.html">Developer Team</a></li>
<li class="toctree-l1"><a class="reference internal" href="bib.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ESPResSo++</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="tutorial.html">Tutorial</a> &raquo;</li>
      
    <li>Adaptive Resolution Simulations</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/tutorial.AdResS.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adaptive-resolution-simulations">
<h1>Adaptive Resolution Simulations<a class="headerlink" href="#adaptive-resolution-simulations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="theory-and-background">
<h2>Theory and Background<a class="headerlink" href="#theory-and-background" title="Permalink to this headline">¶</a></h2>
<p>ESPResSo++ provides functionality to run adaptive resolution simulations using the Adaptive Resolution Simulation Scheme (AdResS). In AdResS molecules in different regions in a simulation box are described by different non-bonded force fields, typically atomistic (AT) and coarse-grained (CG). These different subregions are interfaced and coupled via a hybrid region, where the interaction smoothly changes. Molecules can diffuse between the different regions and change their interaction on the fly.</p>
<p>There are two different AdResS approaches: The force-based scheme, in which forces are interpolated, as well as the energy-based scheme (Hamiltonian AdResS or H-AdResS) which interpolates on the level of potential energies. In force-based AdResS (see, for example, Praprotnik et al., J. Chem. Phys. 123, 224106 (2005) as well as Annu. Rev. Phys. Chem. 59, 545 (2008)), we have for the net force between the molecules <span class="math">\(\alpha\)</span> and <span class="math">\(\beta\)</span></p>
<div class="math">
\[\mathbf{F}_{\alpha|\beta} = \lambda(\mathbf{R}_\alpha)\lambda(\mathbf{R}_\beta)\mathbf{F}_{\alpha|\beta}^{\text{AT}} + \left(1-\lambda(\mathbf{R}_\alpha)\lambda(\mathbf{R}_\beta)\right)\mathbf{F}_{\alpha|\beta}^{\text{CG}},\]</div>
<p>where <span class="math">\(\mathbf{F}_{\alpha|\beta}^{\text{AT}}\)</span> is an AT force field based on the individual atoms belonging to the molecules <span class="math">\(\alpha\)</span> and <span class="math">\(\beta\)</span> and <span class="math">\(\lambda\)</span> is a position dependent resolution function smoothly changing from 1 in the AT region to 0 in the CG region via the hybrid buffer region. It is evaluated based on the molecules&#8217; center of mass positions <span class="math">\(\mathbf{R_\alpha}\)</span>. Note that there can of course also be bonded interactions, but these are typically not interpolated, as they are computationally usually much cheaper to evaluate than the non-bonded forces. For the sake of clarity, we omit them here.</p>
<p>In H-AdResS (see Potestio et al., Phys. Rev. Lett. 110, 108301 (2013)), interpolation is performed directly on potential energies in the Hamiltonian as</p>
<div class="math">
\[H  = \sum_\alpha \sum_{i\in\alpha} \frac{\mathbf{p}_{\alpha i}^2}{2m_{\alpha i}}+\sum_{\alpha} \left\{\lambda({\mathbf{R}_\alpha}) V^{\text{AT}}_\alpha + \left(1 - \lambda({\mathbf{R}_\alpha})\right) V^{\text{CG}}_\alpha \right\},\]</div>
<p>where the first term corresponds to the kinetic energy and we again omitted intramolecular interactions. The forces obtained from this Hamiltonian are</p>
<div class="math">
\[\begin{split}\textbf{F}_{\alpha i} = &amp; \sum_{\beta\neq\alpha}\sum_{j\in\beta}\left\{ \frac{\lambda_\alpha+\lambda_\beta}{2}\textbf{F}_{\alpha i|\beta j}^{\text{AT}} + \left(1-\frac{\lambda_\alpha+\lambda_\beta}{2}\right)\textbf{F}_{\alpha i|\beta}^{\text{CG}}  \right\} \\
&amp; - [V^{\text{AT}}_\alpha - V^{\text{CG}}_\alpha] \,\nabla_{\alpha i}\lambda_\alpha.\end{split}\]</div>
<p>The last term, the so-called drift force, comes from applying the position gradient on the position-dependent resolution function <span class="math">\(\lambda\)</span>. It acts only in the hybrid region and unphysically pushes molecules from one region to the other. Therefore, it needs to be corrected. On the other hand, force-based AdResS, contrary to H-AdResS, does not allow a Hamiltonian formulation at all.</p>
<p>Usually, the force fields used in the different regions of the adaptive simulation setup have significantly different pressures given the same temperature and particle density. This pressure gradient leads, in addition to the drift force in H-AdResS, to particles being pushed across the hybrid region. Eventually, the system would evolve to an equilibrium state with a inhomogeneous density profile across the simulation box. Therefore, correction forces needs to be applied in the hybrid region to counter these effects. In H-AdResS one can use a so-called free energy correction (FEC), which on average cancels the drift force in the hybrid region (see Potestio et al., Phys. Rev. Lett. 110, 108301 (2013)). The FEC corresponds to the free energy difference between the subsystems and can, for instance, be derived from Kirkwood thermodynamic integration. An alternative approach which is typically used to cancel the pressure gradient in force-based AdResS is the so-called thermodynamic force (see Fritsch et al., Phys. Rev. Lett. 108, 170602 (2012)). It is derived by constructing the correction directly from the distorted density profile which is obtained without any correction and then refined iteratively.</p>
</div>
<div class="section" id="espp-code">
<h2>ESPResSo++ code<a class="headerlink" href="#espp-code" title="Permalink to this headline">¶</a></h2>
<p>Several measures had to be taken to implement adaptive resolution simulations in ESPResSo++. On top of the normal particles, which serve as the CG particles in AdResS, another layer of extra AT particles is introduced such that one has access to both atomistic and CG particles throughout the whole system. A mapping between the two defines which atoms belong to which CG bead. The resolution function <span class="math">\(\lambda\)</span> is implemented as a particle property of the CG particles that is updated after each integration step based on the new positions. This happens in an extension to the Velocity Verlet integrator. The actual adaptive resolution scheme is then implemented via new interaction templates that define how forces and energies are computed in force-based and energy-based AdResS. These templates use for particle pairs in the atomistic region the actual atoms, this is the AT particles, for the force and energy computation while in the CG region they use the CG particles. In the hybrid region, both are used, as defined in the equations above. The drift term of H-AdResS is implemented similarly. Furthermore, the AdResS integrator extension makes sure that the atomistic particles in the CG region travel along with the CG particles and that similarly the CG particles in the AT region are properly updated according to the new atomistic positions after each integration step. The FEC as well as a module to apply the Thermodynamic Force are implemented as integrator extensions.</p>
<p>In the following, we explain the new features step by step (more details about parameters etc. can be found in the documention of the different classes).</p>
<div class="section" id="adress-domain-decomposition">
<h3>Adress Domain Decomposition<a class="headerlink" href="#adress-domain-decomposition" title="Permalink to this headline">¶</a></h3>
<p>When setting up the storage we have to use an appropriate domain decomposition that accomodates storage and proper interprocessor communication of both AT and CG particles.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># (H-)AdResS domain decomposition</span>
<span class="n">system</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">DomainDecompositionAdress</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">nodeGrid</span><span class="p">,</span> <span class="n">cellGrid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="atomistic-and-coarse-grained-particles">
<h3>Atomistic and Coarse-Grained particles<a class="headerlink" href="#atomistic-and-coarse-grained-particles" title="Permalink to this headline">¶</a></h3>
<p>When adding particles to the storage, we have to define them as atomistic or coarse-grained. This has been implemented as the particle property &#8220;adrat&#8221;. If it is 0, the particle is coarse-grained. If it is 1, it is an atomistic particle.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># add particles to system</span>
<span class="n">system</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">addParticles</span><span class="p">(</span><span class="n">allParticles</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;mass&quot;</span><span class="p">,</span> <span class="s2">&quot;adrat&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>When adding the particles as above, it is important that a set of atomistic particles belonging to one CG particle appears in the list of particles <code class="docutils literal"><span class="pre">allParticles</span></code> always after the corresponding CG particle.</p>
<p>Next, the FixedTupleListAdress defines which atomistic particles belong to which coarse-grained particles.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># create FixedTupleList object and add the tuples</span>
<span class="n">ftpl</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">FixedTupleListAdress</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">storage</span><span class="p">)</span>
<span class="n">ftpl</span><span class="o">.</span><span class="n">addTuples</span><span class="p">(</span><span class="n">tuples</span><span class="p">)</span>
<span class="n">system</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">setFixedTuplesAdress</span><span class="p">(</span><span class="n">ftpl</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal"><span class="pre">tuples</span></code> is a list of tuples, where each tuple itself is another short list in which the first element is the CG particle and the other elements are the AT particles belonging to it. Note that in ESPResSo++ the CG particle is positioned always in the center of mass of its atoms.</p>
<p>Having set up the FixedTupleList, we can also set up an AdResS fixed pair list that defines bonds between AT particles within individual molecules. This is done in the following way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># add bonds between AT particles</span>
<span class="n">fpl</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">FixedPairListAdress</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="n">ftpl</span><span class="p">)</span>
<span class="n">fpl</span><span class="o">.</span><span class="n">addBonds</span><span class="p">(</span><span class="n">bonds</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">bonds</span></code> is a list of bonds between AT particles within CG molecules. Similarly, triple lists for angles, quadruple lists for dihedrals etc. are set up. Compared to conventional bonds, angles, etc. between different normal CG particles one just adds the suffix <code class="docutils literal"><span class="pre">Adress</span></code> to the appropriate list object and provides it also with the FixedTupleList (<code class="docutils literal"><span class="pre">ftpl</span></code> in the example). Note that you can define several different such fixed pair lists and you can, for example, also in AdResS simulations still use the normal <code class="docutils literal"><span class="pre">FixedPairList</span></code> to define bonds between regular CG particles.</p>
</div>
<div class="section" id="adress-verlet-list">
<h3>AdResS Verlet List<a class="headerlink" href="#adress-verlet-list" title="Permalink to this headline">¶</a></h3>
<p>Next, we construct the AdResS Verlet list object for non-bonded interacting particle pairs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># AdResS Verlet list</span>
<span class="n">vl</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">VerletListAdress</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">adrcut</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span>
                                <span class="n">dEx</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">dHy</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                <span class="n">adrCenter</span><span class="o">=</span><span class="p">[</span><span class="n">Lx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ly</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Lz</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">sphereAdr</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>We have to provide the cutoffs of the list as well as the sizes of the atomistic and hybrid regions. The parameter <code class="docutils literal"><span class="pre">cutoff</span></code> corresponds to the cutoff used for CG particle pairs with both particles being in the CG region, while <code class="docutils literal"><span class="pre">adrcut</span></code> is the cutoff for all other particle pairs (at least one particle of the pair is in the AT or hybrid region). We want to stress that this  pair list is build based on the CG particles&#8217; positions. Hence, for the AT and hybrid region one needs in some situations to provide a Verlet list cutoff (adrcut) slightly larger than the actual maximum interaction range of the potential, in order to not lose interactions between some atom pairs. Let us clarify this with an example: Thinking of a pair of water molecules, both coarse-grained into single beads, these CG beads could be farther apart than the interaction cutoff. Two hydrogen atoms pointing towards each other, however, could in fact still be in interaction range. Therefore, an appropriate buffer needs to be provided.</p>
<p>The <code class="docutils literal"><span class="pre">sphereAdr</span></code> flag decides how to geometrically set up the change in resolution. If it&#8217;s true, the AT region is a spherical region positioned at <code class="docutils literal"><span class="pre">adrCenter</span></code> with radius <code class="docutils literal"><span class="pre">dEx</span></code>. If <code class="docutils literal"><span class="pre">sphereAdr</span></code> is false, the resolution changes along the x-axis of the system and <code class="docutils literal"><span class="pre">dEx</span></code> corresponds to half the width of the AT region. <code class="docutils literal"><span class="pre">dHy</span></code> always is the full width of the hybrid region. Instead of providing a 3D position for <code class="docutils literal"><span class="pre">adrCenter</span></code> as above, one can also provide a particle ID of a CG particle. In this case, the atomistic region will follow the movement of the particle. This should be only done, however, for force-based AdResS, since it would break the Hamiltonian character of H-AdResS, and also only when using a spherical adaptive geometry. Then, however, it is even possible to provide a list of particle IDs, in which case the AT region corresponds to the overlap of the spherical regions defined by the individual particles provided in the list. It will deform accordingly while these particle move.</p>
</div>
<div class="section" id="interactions">
<h3>Interactions<a class="headerlink" href="#interactions" title="Permalink to this headline">¶</a></h3>
<p>When adding interactions to the system we have to use the corresponding interaction templates. Here is how to set up a non-bonded interaction in a H-AdResS system:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># H-AdResS non-bonded interaction: WCA potential between AT particles</span>
<span class="c1"># and tabulated potential between CG particles</span>
<span class="n">interNB</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">interaction</span><span class="o">.</span><span class="n">VerletListHadressLennardJones</span><span class="p">(</span><span class="n">vl</span><span class="p">,</span> <span class="n">ftpl</span><span class="p">)</span>
<span class="n">potWCA</span>  <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">interaction</span><span class="o">.</span><span class="n">LennardJones</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                  <span class="n">cutoff</span><span class="o">=</span><span class="n">rca</span><span class="p">)</span>
<span class="n">potCG</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">interaction</span><span class="o">.</span><span class="n">Tabulated</span><span class="p">(</span><span class="n">itype</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">tabCG</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="n">rc</span><span class="p">)</span> <span class="c1"># CG</span>
<span class="n">interNB</span><span class="o">.</span><span class="n">setPotentialAT</span><span class="p">(</span><span class="n">type1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">type2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">potential</span><span class="o">=</span><span class="n">potWCA</span><span class="p">)</span> <span class="c1"># AT</span>
<span class="n">interNB</span><span class="o">.</span><span class="n">setPotentialCG</span><span class="p">(</span><span class="n">type1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">type2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">potential</span><span class="o">=</span><span class="n">potCG</span><span class="p">)</span> <span class="c1"># CG</span>
<span class="n">system</span><span class="o">.</span><span class="n">addInteraction</span><span class="p">(</span><span class="n">interNB</span><span class="p">)</span>
</pre></div>
</div>
<p>First, we define the appropriate interaction type, in H-AdResS this is <code class="docutils literal"><span class="pre">VerletListHadressLennardJones</span></code>. Next we define the actual potentials. Then we associate them with the H-AdResS interaction and add the interaction to the system. For force-based AdResS the only change required would be to use the <code class="docutils literal"><span class="pre">VerletListAdressLennardJones</span></code> interaction.</p>
<p>Note that the here used interaction, <code class="docutils literal"><span class="pre">VerletListHadressLennardJones</span></code>, couples only Lennard-Jones-type potentials with tabulated ones. However, there exist more such interaction templates for other potentials and potential combinations.</p>
</div>
<div class="section" id="adress-integrator-extension">
<h3>AdResS Integrator Extension<a class="headerlink" href="#adress-integrator-extension" title="Permalink to this headline">¶</a></h3>
<p>Finally, we have to set up the AdResS integrator extension:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># AdResS integrator extension</span>
<span class="n">adress</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">Adress</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">verletlist</span><span class="p">,</span> <span class="n">ftpl</span><span class="p">,</span> <span class="n">regionupdates</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">integrator</span><span class="o">.</span><span class="n">addExtension</span><span class="p">(</span><span class="n">adress</span><span class="p">)</span>
</pre></div>
</div>
<p>It takes as arguments the Verlet list and the fixed tuple list. Additionally, for the case of a moving and/or deforming AdResS region based on one or more particles, the parameter <code class="docutils literal"><span class="pre">regionupdates</span></code> specifies how regularly we want to update the shape of the AdResS region in number of steps. This is to avoid as much as possible of the additional communication required to inform different processors of the change of the AdResS region. The parameter defaults to 1 and is not used at all for static AdResS regions.</p>
<p>Having set up the AdResS extension, we can distribute all particles in the box and place the CG molecules in the centers of mass of the atoms which they belong to. This can be done conveniently via</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># distribute atoms and CG molecules according to AdResS domain decomposition,</span>
<span class="c1"># place CG molecules in the center of mass</span>
<span class="n">espressopp</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">AdressDecomp</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="free-energy-compensation">
<h3>Free Energy Compensation<a class="headerlink" href="#free-energy-compensation" title="Permalink to this headline">¶</a></h3>
<p>When using H-AdResS, we probably want to also employ a FEC. This can be done as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># set up FEC</span>
<span class="n">fec</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">FreeEnergyCompensation</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="n">Lx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ly</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Lz</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
<span class="n">fec</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="n">itype</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;table_fec.tab&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">integrator</span><span class="o">.</span><span class="n">addExtension</span><span class="p">(</span><span class="n">fec</span><span class="p">)</span>
</pre></div>
</div>
<p>The FEC takes as arguments the system object as well as the center of the AT region. Then we add the actual force, which needs to be provided in a table (first column: resolution <span class="math">\(\lambda\)</span>, second: energy, third: force). <code class="docutils literal"><span class="pre">itype</span></code> defines which type of interpolation should be used for values between the ones provided in the table. 1 corresponds to linear interpolation, 2 to akima splines, 3 to cubic splines. We suggest to use cubic splines. The FEC is applied on CG particles and distributed among the atoms belonging to the CG particle. <code class="docutils literal"><span class="pre">type</span></code> specifies the CG particle type for which this correction should be applied. One can, for example, use different FECs for different molecules types.</p>
</div>
<div class="section" id="thermodynamic-force">
<h3>Thermodynamic Force<a class="headerlink" href="#thermodynamic-force" title="Permalink to this headline">¶</a></h3>
<p>When using force-based AdResS, or, alternatively, in addition to the FEC in H-AdResS, we can use the thermodynamic force. It can be set up in the following way, very similar to the FEC before:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># set up Thermodynamic Force</span>
<span class="n">thdforce</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">TDforce</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">verletlist</span><span class="p">)</span>
<span class="n">thdforce</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="n">itype</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;table_tf.tab&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">integrator</span><span class="o">.</span><span class="n">addExtension</span><span class="p">(</span><span class="n">thdforce</span><span class="p">)</span>
</pre></div>
</div>
<p>It works largely as for the FEC with the following differences: The table should not provide resolution values in the first column but actual distance values, this is, the distance from the (closest) AT region center. This allows to extend the application of the thermodynamic force slightly beyond the borders of the hybrid region where the resolution is constant. Furthermore, the Thermodynamic Force needs the verletlist as argument.</p>
<p>It is also possible to define a thermodynamic force, which is suited for an adaptive resolution setup with an AT region that is constructed via the overlap of several spherical regions. In this case, the extension needs more information:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># set up Thermodynamic Force</span>
<span class="n">thdforce</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">TDforce</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">verletlist</span><span class="p">,</span> <span class="n">startdist</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
                                    <span class="n">enddist</span> <span class="o">=</span> <span class="mf">2.1</span><span class="p">,</span> <span class="n">edgeweightmultiplier</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">thdforce</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="n">itype</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;table_tf.tab&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">integrator</span><span class="o">.</span><span class="n">addExtension</span><span class="p">(</span><span class="n">thdforce</span><span class="p">)</span>
</pre></div>
</div>
<p>It gets three more parameters, <code class="docutils literal"><span class="pre">startdist</span></code>, <code class="docutils literal"><span class="pre">enddist</span></code> and <code class="docutils literal"><span class="pre">edgeweightmultiplier</span></code>. <code class="docutils literal"><span class="pre">startdist</span></code> explicitely says at which distance from the center of the closest AT region defining particle the thermodynamic force starts to act and <code class="docutils literal"><span class="pre">enddist</span></code> says where it ends. Hence, these value should correspond to what is actually written in the table. <code class="docutils literal"><span class="pre">edgeweightmultiplier</span></code> is a parameter that speficies how precisely the thermodynamic force should be applied in the overlap regions of different spheres. For most applications, however, 20 should provide reasonable results (for details, see Kreis et al., J. Chem. Theory Comput. 12, 4067 (2016)). The 3 additional parameters are of course also present with some default values in the basic case, but they are ignored unless we have an AT region that is constructed via the overlap of several spherical regions.</p>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>We have provided several example scripts and setups that are available in the ESPResSo++ source code at <code class="docutils literal"><span class="pre">examples/adress</span></code>. Most of them are based on published papers.</p>
<p>The reader is strongly encouraged to play around with them and test what happens when the setups are modified. Possible questions to ask are provided at the end of the following subsections, which explain the individual examples in more detail.</p>
<div class="section" id="force-adress-tetrahedral-liquid">
<h3>Force-AdResS: Tetrahedral Liquid<a class="headerlink" href="#force-adress-tetrahedral-liquid" title="Permalink to this headline">¶</a></h3>
<p>Subfolder: <code class="docutils literal"><span class="pre">fadress_tetraliquid</span></code>. This example consists of the system that was used in the initial work introducing the force-based adaptive resolution method (see Praprotnik et al., J. Chem. Phys. 123, 224106 (2005) and Phys. Rev. E 73, 066701 (2006)). A liquid composed of artificial tetrahedral molecules, i.e. each molecule consists of 4 bonded atoms arranged in a tetrahedral geometry, is coupled to a CG model which describes the molecules as individual beads.</p>
<p>Questions: The geometry is set in such a way that the resolution changes along the x-axis of the box. Try changing the setup such that the AT region is of spherical shape. You can also try removing the thermostat. Does the system conserve energy? Also vary the size of the atomistic region and see what happens. Can you also make the system all-atomistic or all-CG? You can also try to compare computational times.</p>
</div>
<div class="section" id="force-adress-a-protein-in-water">
<h3>Force-AdResS: A Protein in Water<a class="headerlink" href="#force-adress-a-protein-in-water" title="Permalink to this headline">¶</a></h3>
<p>Subfolder: <code class="docutils literal"><span class="pre">fadress_protein</span></code>. This system is an aqueous solution of the regulatory protein ubiquitin. The atomistic protein and the atomistic water around it is coupled to a coarse-grained water model, which maps water molecules farther away from the protein to single beads. The CG water interaction was parametrized with iterative Boltzmann inversion (IBI).  This system is similar to the setup which was used by Fogarty et al. (J. Chem. Phys. 142, 195101 (2015)) to study the structure and dynamics of a protein hydration shell.</p>
<p>Questions: The setup is significantly more complicated than the previous system. Try to understand the script. You can also have a look into the the actual source code and try to understand, for example, how the gromacs parser works. The example is set up as a fully atomistic simulation by setting the size of the atomistic region to a value larger than the simulation box. Try to change the script such that it is an actual adaptive setup. Do not forget the thermodynamic force! Furthermore, how is the high-resolution region positioned now?</p>
</div>
<div class="section" id="force-adress-self-adjusting-adaptive-resolution-simulations">
<h3>Force-AdResS: Self-Adjusting Adaptive Resolution Simulations<a class="headerlink" href="#force-adress-self-adjusting-adaptive-resolution-simulations" title="Permalink to this headline">¶</a></h3>
<p>Subfolder: <code class="docutils literal"><span class="pre">fadress_selfadjusting</span></code>. This setup demonstrates how force-based adaptive resolution simulations with self-adjusting high-resolution regions can be set up (Kreis et al., J. Chem. Theory Comput. 12, 4067 (2016)). The system is a polyalanine-9 molecule in aqueous solution. A spherical AT region is associated with each atom of the peptide such that the overall AT region formed by the overlap of all these spheres elegantly envelops the peptide. The peptide starts in an extended configuration and as it folds, the AT region surrounding it adjusts itself accordingly. At the outside, we use again a coarse-grained IBI single-bead model for the water molecules.</p>
<p>Questions: Can you change the system such that fewer atoms are associated with AT region, for example, only the heavy atoms? Can you change the update frequency of the shape of the AT region?</p>
</div>
<div class="section" id="h-adress-tetrahedral-liquid">
<h3>H-AdResS: Tetrahedral Liquid<a class="headerlink" href="#h-adress-tetrahedral-liquid" title="Permalink to this headline">¶</a></h3>
<p>Subfolder: <code class="docutils literal"><span class="pre">hadress_tetraliquid</span></code>. This is the system used by Potestio et al. in the paper that proposed the H-AdResS method (Phys. Rev. Lett. 110, 108301 (2013)). It is again a simple system composed of tetrahedral molecules that change their resolution and become individual beads in the CG region. The interpolation occurs along the x-axis. This example has three subfolders.</p>
<p>The first folder <code class="docutils literal"><span class="pre">hadress_tetraliquid_plain</span></code> runs a simple H-AdResS simulation without any free energy correction. Hence, the drift force strongly pushes molecules from one region to the other. The script contains analysis routines which measure both a density and a pressure profile along the direction of resolution change while the simulation is running. Gathering enough statistics takes a while, but we have also provided reference profiles which are obtained after a sufficiently long simulation. Have a look at them and try to interpret them.</p>
<p>The second folder <code class="docutils literal"><span class="pre">hadress_tetraliquid_FEC</span></code> contains the same setup but with a free energy correction. For this, two tables are provided, <code class="docutils literal"><span class="pre">table_FEC_Helmholtz.dat</span></code> and <code class="docutils literal"><span class="pre">table_FEC_Gibbs.dat</span></code>. They were derived via Kirkwood thermodynamic integration. The first one is based on the Helmholtz free energy difference per particle between the two subsystem, and the second one corresponds to the Gibbs free energy difference per particle. Two density and pressure profiles obtained while applying these correction are also shown. Try to interpret them.</p>
<p>The third folder <code class="docutils literal"><span class="pre">hadress_tetraliquid_KTI</span></code> contains a simple implementation of Kirkwood thermodynamic integration (KTI) which could in principle, when run for long enough, be used to derive the FEC. This is not an adaptive resolution simulation. Instead, we tell the AdResS integrator extension that we want to run KTI. Then, the extension does not modify the resolution values associated with the different molecules and we can change them by hand during the simulation. In this way, we can set up a simulation in which we change the resolution of all molecules in the system every few steps and slowly proceed from a complete CG system to an all-atom one. Have a look and try to understand what is going on.</p>
<p>There are many more interesting things you can try out: Are the H-AdResS simulations energy conserving? Add the commented Langevin thermostat and compare. Also vary the timestep. Additionally, you can change the size of the hybrid region. What happens if it becomes smaller or larger? Furthermore, what happens if you change the system from H-AdResS to force-based AdResS?</p>
</div>
<div class="section" id="h-adress-water">
<h3>H-AdResS: Water<a class="headerlink" href="#h-adress-water" title="Permalink to this headline">¶</a></h3>
<p>Subfolder: <code class="docutils literal"><span class="pre">hadress_water</span></code>. This is a slightly more advanced H-AdResS system in which an atomistic model is coupled to a coarse-grained one, mapping the three water atoms onto single beads.</p>
<p>Questions: Feel free to play around with the system. You could also try to figure out, how the gromacs parsers sets up the interactions and chooses the right H-AdResS interactions.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial.ThermodynamicIntegration.html" class="btn btn-neutral float-right" title="Thermodynamic integration" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial.AddNewPotential.html" class="btn btn-neutral" title="AddNewPotential" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2017, Max Planck Institute for Polymer Research.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.9.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
  <div class="footer">
      <a href="http://www.mpip-mainz.mpg.de"><img src="static/mpip_logo.png" id="mpip_logo"></a>
      <a href="http://www.scai.fraunhofer.de"><img src="static/scai_logo.png" id="scai_logo"></a>
  </div>
  </div>


</body>
</html>