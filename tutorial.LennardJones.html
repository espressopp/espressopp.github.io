<div id="outer">

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Simple Lennard Jones System &mdash; ESPResSo++ 1.7 documentation</title>
    
    <link rel="stylesheet" href="static/classic.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="shortcut icon" href="static/favicon.ico"/>
    <link rel="top" title="ESPResSo++ 1.7 documentation" href="index.html" />
    <link rel="up" title="ESPResSo++ Tutorial" href="tutorial.html" />
    <link rel="next" title="Advanced Lennard Jones System" href="tutorial.LennardJones2.html" />
    <link rel="prev" title="Basic System Setup" href="tutorial.SystemSetup.html" /> 
  </head>
  <body role="document">
  <div class="header"></div>


  
    <div class="menu">
      <ul class="nav">
	<li><a href="../index.html">Home</a></li>
	<li><a href="../Features.html">Features</a></li>
	<li><a href="../Download.html">Download</a></li>
	<li><a href="index.html">Documentation</a></li>
	<li><a href="../Developer_Team.html">Developer Team</a></li>
	<li><a href="../Getting_Help.html">Getting Help</a></li>
	<li id="impressum"><a href="../Impressum.html">Impressum</a></li>
      </ul>
      <div id="searchbox" style="display: none">
	<form class="search" action="search.html" method="get">
	  <input type="text" name="q" size="12" />
	  <input type="submit" value="Search" />
	  <input type="hidden" name="check_keywords" value="yes" />
	  <input type="hidden" name="area" value="default" />
	</form>
      </div>
      <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
   

  <div class="document">
      <div class="documentwrapper">
	<div class="bodywrapper">
	  <div class="body">
            
             <a href="tutorial.SystemSetup.html">previous</a>
            
            
             <a style="float:right;"  href="tutorial.LennardJones2.html">next</a>
            
	    
  <div class="section" id="simple-lennard-jones-system">
<h1>Simple Lennard Jones System<a class="headerlink" href="#simple-lennard-jones-system" title="Permalink to this headline">Â¶</a></h1>
<p>Lets just copy and paste the beginning from the &#8220;System Setup&#8221; tutorial:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">espressopp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">espressopp</span> <span class="kn">import</span> <span class="n">Real3D</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">system</span>         <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">System</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">box</span>            <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rng</span>            <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">esutil</span><span class="o">.</span><span class="n">RNG</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bc</span>             <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">OrthorhombicBC</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">system</span><span class="o">.</span><span class="n">bc</span>      <span class="o">=</span> <span class="n">bc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">system</span><span class="o">.</span><span class="n">rng</span>     <span class="o">=</span> <span class="n">rng</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">maxcutoff</span>      <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="mf">6.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skin</span>           <span class="o">=</span> <span class="mf">0.4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">system</span><span class="o">.</span><span class="n">skin</span>    <span class="o">=</span> <span class="n">skin</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nodeGrid</span>       <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cellGrid</span>       <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nodeGrid</span>       <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decomp</span><span class="o">.</span><span class="n">nodeGrid</span><span class="p">(</span><span class="n">espressopp</span><span class="o">.</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cellGrid</span>       <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">decomp</span><span class="o">.</span><span class="n">cellGrid</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">nodeGrid</span><span class="p">,</span> <span class="n">maxcutoff</span><span class="p">,</span> <span class="n">skin</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ddstorage</span>      <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">DomainDecomposition</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">nodeGrid</span><span class="p">,</span> <span class="n">cellGrid</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">system</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">ddstorage</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span>     <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">VelocityVerlet</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span>             <span class="o">=</span> <span class="mf">0.005</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span><span class="o">.</span><span class="n">dt</span>  <span class="o">=</span> <span class="n">dt</span>
</pre></div>
</div>
<p>And lets add some random particles:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">num_particles</span> <span class="o">=</span> <span class="mi">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">particle_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_particles</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">pid</span>  <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">pos</span>  <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">bc</span><span class="o">.</span><span class="n">getRandomPos</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">v</span>    <span class="o">=</span> <span class="n">Real3D</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">mass</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">rng</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="nb">type</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">part</span> <span class="o">=</span> <span class="p">[</span><span class="n">pid</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">mass</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">particle_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">system</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">addParticles</span><span class="p">(</span><span class="n">particle_list</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;pos&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="s">&#39;mass&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">system</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</pre></div>
</div>
<p>All particles should interact via a Lennard Jones potential:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">LJPot</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">interaction</span><span class="o">.</span><span class="n">LennardJones</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="n">maxcutoff</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>shift=True means that the potential will be shifted at the cutoff so that potLJ(cutoff)=0
Next we create a VerletList which will than be used in the interaction:
(the Verlet List object needs to know from which system to get its particles and which cutoff to use)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">verletlist</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">VerletList</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="n">maxcutoff</span><span class="p">)</span>
</pre></div>
</div>
<p>Now create a non bonded interaction object and add the Lennard Jones potential to that:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">NonBondedInteraction</span> <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">interaction</span><span class="o">.</span><span class="n">VerletListLennardJones</span><span class="p">(</span><span class="n">verletlist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NonBondedInteraction</span><span class="o">.</span><span class="n">setPotential</span><span class="p">(</span><span class="n">type1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">type2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">potential</span><span class="o">=</span><span class="n">LJPot</span><span class="p">)</span>
</pre></div>
</div>
<p>Tell the system about the newly created NonBondedInteraction object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">system</span><span class="o">.</span><span class="n">addInteraction</span><span class="p">(</span><span class="n">NonBondedInteraction</span><span class="p">)</span>
</pre></div>
</div>
<p>We should set the langevin thermostat in the integrator to cool down the random particle system:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">langevin</span>             <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">LangevinThermostat</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">langevin</span><span class="o">.</span><span class="n">gamma</span>       <span class="o">=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">langevin</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span><span class="o">.</span><span class="n">addExtension</span><span class="p">(</span><span class="n">langevin</span><span class="p">)</span>
</pre></div>
</div>
<p>and finally let the system run and see how it relaxes or explodes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">espressopp</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">integrator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">espressopp</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
</pre></div>
</div>
<p>Due to the random particle positions it may happen, that two or more particles are very close to
each other and the resulting repulsive force between them are so high that they &#8216;shoot off&#8217; in
different directions with very high speed. Usually the numbers are then larger than the computer
can deal with. A typical error message you get could look like this:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ERROR: particle 5 has moved to outer space (one or more coordinates are nan)</p>
</div>
<p>In order to prevent this, systems that are setup in a random way and thus have strong overlaps between particels
have to be &#8220;warmed up&#8221; before they can be equilibrated.</p>
<p>In ESPResSo++ there are several possible ways of warming up a system. As a first approach one could simply constrain
the forces in the integrator. For this purpose ESPResSo++ provides an integrator Extension
named CapForces. The two parameters of this Extension are the system and the maximum force that
a particle can get. The following python code shows how CapForces can be used. Add it to your
Lennard-Jones example just after adding the Langevin Extension:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;starting warmup with force capping ...&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">force_capping</span>   <span class="o">=</span> <span class="n">espressopp</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">CapForce</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="mf">1000000.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span><span class="o">.</span><span class="n">addExtension</span><span class="p">(</span><span class="n">force_capping</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># reduce the time step of the integrator to make the integration numerically more stable</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">espressopp</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">integrator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="n">espressopp</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
</pre></div>
</div>
<p>After the warmup the time step of the integrator can be set to a larger value.
The CapForce extension can be disconnected after the warmup to get the original
full Lennard-Jones potential back.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span><span class="o">.</span><span class="n">dt</span>   <span class="o">=</span> <span class="mf">0.005</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">force_capping</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;warmup finished - force capping switched off.&quot;</span>
</pre></div>
</div>
<div class="section" id="task-1">
<h2>Task 1:<a class="headerlink" href="#task-1" title="Permalink to this headline">Â¶</a></h2>
<p>write a python script that creates a random configuration of 1000 Lennard Jones
particles with a number density of 0.85 in a cubic simulation box.
Warm up and equilibrate this configuration.
Examine the output of the command</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">espressopp</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">analyse</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
</pre></div>
</div>
<p>after each integration step. How fast is the energy of the system going down ?
How long do you have to warmup ? What are good parameters for
dt, force_capping and number of integration steps ?</p>
</div>
</div>


            
             <a href="tutorial.SystemSetup.html">previous</a>
                
            
             <a style="float:right;"  href="tutorial.LennardJones2.html">next</a>
            
          </div>
        </div>
     </div> 
 </div>
  </body>
</html>